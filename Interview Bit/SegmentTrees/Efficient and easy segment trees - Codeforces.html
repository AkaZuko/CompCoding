<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- saved from url=(0038)http://codeforces.com/blog/entry/18051 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="X-Csrf-Token" content="69ee2bd7d44d6e12dd066fadc0fc0172">
    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=0.01">
    <script id="facebook-jssdk" src="./Efficient and easy segment trees - Codeforces_files/all.js"></script><script type="text/javascript" async="" src="./Efficient and easy segment trees - Codeforces_files/ga.js"></script><script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery-1.8.3.js"></script>
    <script type="application/javascript">
        function adjustViewport() {
            var screenWidthPx = Math.min($(window).width(), window.screen.width);
            var siteWidthPx = 1100; // min width of site
            var ratio = Math.min(screenWidthPx / siteWidthPx, 1.0);
            var viewport = "width=device-width, initial-scale=" + ratio;
            $('#viewport').attr('content', viewport);
            var style = $('<style>html * { max-height: 1000000px; }</style>');
            $('html > head').append(style);
        }

        if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
            adjustViewport();
        }
    </script>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <meta http-equiv="profileName" content="p1">
    <meta name="google-site-verification" content="OTd2dN5x4nS4OPknPI9JFg36fKxjqY0i1PSfFPv_J90">
    <meta property="fb:admins" content="100001352546622">
    <meta property="og:image" content="http://st.codeforces.com/s/95517/images/codeforces-telegram-square.png">
    <link rel="image_src" href="http://st.codeforces.com/s/95517/images/codeforces-telegram-square.png">
    <meta property="og:title" content="Efficient and easy segment trees - Codeforces">
    <meta property="og:description" content="">
    
    <meta property="og:site_name" content="Codeforces">
    <meta name="uc" content="e9e0ede7d697ffb9ddf242373eb890c03aa3deef">
    
    
    
    
    <meta name="utc_offset" content="+03:00">
    <meta name="verify-reformal" content="f56f99fd7e087fb6ccb48ef2">
    <title>Efficient and easy segment trees - Codeforces</title>
        <meta name="description" content="Codeforces. Programming competitions and contests, programming community">
        <meta name="keywords" content="programming algorithm contest competition informatics olympiads c++ java graphs vkcup">
    <meta name="robots" content="index, follow">

    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/font-awesome.min.css" type="text/css" charset="utf-8">

        <link href="./Efficient and easy segment trees - Codeforces_files/css" rel="stylesheet" type="text/css">
        <link href="./Efficient and easy segment trees - Codeforces_files/css(1)" rel="stylesheet" type="text/css">


    <link rel="shortcut icon" type="image/png" href="http://st.codeforces.com/s/95517/favicon.png">

    <!--CombineResourcesFilter-->
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/prettify.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/clear.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/style.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/ttypography.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/problem-statement.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/second-level-menu.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/roundbox.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/datatable.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/table-form.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/topic.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/jquery.jgrowl.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/facebox.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/jquery.wysiwyg.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/jquery.autocomplete.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/codeforces.datepick.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/colorbox.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/jquery.drafts.css" type="text/css" charset="utf-8">
        <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/community.css" type="text/css" charset="utf-8">

    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/prettify.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/moment.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/pushstream.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.easing.min.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.lavalamp.min.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.jgrowl.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.swipe.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/facebox.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.wysiwyg.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/wysiwyg.colorpicker.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/wysiwyg.table.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/wysiwyg.image.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/wysiwyg.link.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.autocomplete.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.datepick.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.ie6blocker.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.colorbox-min.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.ba-bbq.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.drafts.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/sjcl.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/codeforces-options.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/codeforces.js"></script>
    <!--/CombineResourcesFilter-->

    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/style(1).css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="./Efficient and easy segment trees - Codeforces_files/style(2).css" type="text/css" charset="utf-8">

    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/share.js" charset="utf-8"></script>

    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/jquery.markitup.js"></script>
    <script type="text/javascript" src="./Efficient and easy segment trees - Codeforces_files/set.js"></script>

    <!--[if IE]>
    <style>
        #sidebar {
            padding-left: 1em;
            margin: 1em 1em 1em 0;
        }
    </style>
    <![endif]-->


<style type="text/css" id="ya_share_style">.b-share-popup-wrap{z-index:1073741823;position:absolute;width:500px}.b-share-popup{position:absolute;z-index:1073741823;border:1px solid #888;background:#FFF;color:#000}.b-share-popup-wrap .b-share-popup_down{top:0}.b-share-popup-wrap .b-share-popup_up{bottom:0}.b-share-popup-wrap_state_hidden{position:absolute!important;top:-9999px!important;right:auto!important;bottom:auto!important;left:-9999px!important;visibility:hidden!important}.b-share-popup,x:nth-child(1){border:0;padding:1px!important}@media all and (resolution=0){.b-share-popup,x:nth-child(1),x:-o-prefocus{padding:0!important;border:1px solid #888}}.b-share-popup__i{display:-moz-inline-box;display:inline-block;padding:5px 0!important;overflow:hidden;vertical-align:top;white-space:nowrap;visibility:visible;background:#FFF;-webkit-box-shadow:0 2px 9px rgba(0,0,0,.6);-moz-box-shadow:0 2px 9px rgba(0,0,0,.6);box-shadow:0 2px 9px rgba(0,0,0,.6)}.b-share-popup__item{font:1em/1.25em Arial,sans-serif;display:block;padding:5px 15px!important;white-space:nowrap;background:#FFF}.b-share-popup__item,a.b-share-popup__item:link,a.b-share-popup__item:visited{text-decoration:none!important;border:0!important}a.b-share-popup__item{cursor:pointer}a.b-share-popup__item .b-share-popup__item__text{display:inline;text-decoration:underline;color:#1A3DC1}a.b-share-popup__item:hover{word-spacing:0}a.b-share-popup__item:hover .b-share-popup__item__text{color:red;cursor:pointer}.b-share-popup__icon{display:-moz-inline-box;display:inline-block;margin:-3px 0 0;padding:0 5px 0 0!important;vertical-align:middle}.b-share-popup__icon_input{width:21px;height:16px;margin-top:-6px;padding:0!important}.b-share-popup__icon__input{margin-right:0;margin-left:2px;vertical-align:top}.b-share-popup__spacer{display:block;padding-top:10px!important}.b-share-popup__header{font:86%/1em Verdana,sans-serif;display:block;padding:10px 15px 5px!important;color:#999}.b-share-popup__header_first{padding-top:5px!important}.b-share-popup__input{font:86%/1em Verdana,sans-serif;display:block;padding:5px 15px!important;color:#999;text-align:left}.b-share-popup__input__input{font:1em/1em Verdana,sans-serif;display:block;width:10px;margin:5px 0 0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;resize:none;text-align:left;direction:ltr}.b-share-popup_down .b-share-popup_with-link .b-share-popup__input_link{position:absolute;top:5px;right:0;left:0}.b-share-popup_up .b-share-popup_with-link .b-share-popup__input_link{position:absolute;right:0;bottom:5px;left:0}.b-share-popup_down .b-share-popup_with-link{padding-top:55px!important}.b-share-popup_up .b-share-popup_with-link{padding-bottom:55px!important}.b-share-popup_down .b-share-popup_expandable .b-share-popup__main{padding-bottom:25px!important}.b-share-popup_up .b-share-popup_expandable .b-share-popup__main{padding-top:25px!important}.b-share-popup_down .b-share-popup_yandexed{padding-bottom:10px!important}.b-share-popup_up .b-share-popup_yandexed{padding-top:10px!important}.b-share-popup__yandex{position:absolute;right:4px;bottom:2px;font:78.125%/1em Verdana,sans-serif;padding:3px!important;background:0 0}a.b-share-popup__yandex:link,a.b-share-popup__yandex:visited{color:#C6C5C5;text-decoration:none}a.b-share-popup__yandex:link:hover,a.b-share-popup__yandex:visited:hover{color:red;text-decoration:underline}.b-share-popup_up .b-share-popup__yandex{top:2px;bottom:auto}.b-share-popup_expandable .b-share-popup__yandex{right:auto;left:4px}.b-share-popup_to-right .b-share-popup_expandable .b-share-popup__yandex{right:4px;left:auto}.b-share-popup__expander .b-share-popup__item{position:absolute;bottom:5px;font:86%/1em Verdana,sans-serif;margin:10px 0 0;padding:5px 10px!important;cursor:pointer;color:#999;background:0 0}.b-share-popup_to-right,.b-share-popup_to-right .b-share-popup__expander{direction:rtl}.b-share-popup_to-right .b-share-popup__expander .b-share-popup__icon{padding:0 0 0 5px!important}.b-share-popup_up .b-share-popup__expander .b-share-popup__item{top:-5px;bottom:auto}.b-share-popup__expander .b-share-popup__item:hover .b-share-popup__item__text{text-decoration:underline}.b-share-popup__expander .b-ico_action_rarr,.b-share-popup_to-right .b-share-popup__expander .b-ico_action_larr,.b-share-popup_full .b-share-popup__expander .b-ico_action_larr,.b-share-popup_to-right .b-share-popup_full .b-share-popup__expander .b-ico_action_rarr,.b-share-popup__expander .b-share-popup__item__text_collapse,.b-share-popup_full .b-share-popup__item__text_expand{display:none}.b-share-popup_to-right .b-share-popup__expander .b-ico_action_rarr,.b-share-popup_full .b-share-popup__item__text_collapse,.b-share-popup_full .b-share-popup__expander .b-ico_action_rarr,.b-share-popup_to-right .b-share-popup_full .b-share-popup__expander .b-ico_action_larr{display:inline}.b-ico_action_rarr,.b-ico_action_larr{width:8px;height:7px;border:0}.b-share-popup__main,.b-share-popup__extra{direction:ltr;vertical-align:bottom;text-align:left}.b-share-popup_down .b-share-popup__main,.b-share-popup_down .b-share-popup__extra{vertical-align:top}.b-share-popup__main{display:-moz-inline-stack;display:inline-block}.b-share-popup__extra{display:none;margin:0 -10px 0 0}.b-share-popup_full .b-share-popup__extra{display:-moz-inline-stack;display:inline-block}.b-share-popup_to-right .b-share-popup__extra{margin:0 0 0 -10px}.b-share-popup__tail{position:absolute;width:21px;height:10px;margin:0 0 0 -11px}.b-share-popup_down .b-share-popup__tail{top:-10px;background:url("//yastatic.net/share/static/b-share-popup_down__tail.gif") 0 0 no-repeat}.b-share-popup_up .b-share-popup__tail{bottom:-10px;background:url("//yastatic.net/share/static/b-share-popup_up__tail.gif") 0 0 no-repeat}.b-share-popup_down .b-share-popup__tail,x:nth-child(1){top:-9px;background-image:url("//yastatic.net/share/static/b-share-popup_down__tail.png")}.b-share-popup_up .b-share-popup__tail,x:nth-child(1){bottom:-9px;background-image:url("//yastatic.net/share/static/b-share-popup_up__tail.png")}@media all and (resolution=0){.b-share-popup_down .b-share-popup__tail,x:nth-child(1),x:-o-prefocus{top:-10px;background-image:url("//yastatic.net/share/static/b-share-popup_down__tail.gif")}.b-share-popup_up .b-share-popup__tail,x:nth-child(1),x:-o-prefocus{bottom:-10px;background-image:url("//yastatic.net/share/static/b-share-popup_up__tail.gif")}}.b-share-popup .b-share-popup_show_form_mail,.b-share-popup .b-share-popup_show_form_html{padding:0!important}.b-share-popup .b-share-popup_show_form_mail .b-share-popup__main,.b-share-popup .b-share-popup_show_form_html .b-share-popup__main,.b-share-popup .b-share-popup_show_form .b-share-popup__main,.b-share-popup .b-share-popup_show_form_mail .b-share-popup__extra,.b-share-popup .b-share-popup_show_form_html .b-share-popup__extra,.b-share-popup .b-share-popup_show_form .b-share-popup__extra{height:15px;padding:0!important;overflow:hidden;visibility:hidden}.b-share-popup_show_form_mail .b-share-popup__expander,.b-share-popup_show_form_html .b-share-popup__expander,.b-share-popup_show_form .b-share-popup__expander,.b-share-popup_show_form_mail .b-share-popup__input_link,.b-share-popup_show_form_html .b-share-popup__input_link,.b-share-popup_show_form .b-share-popup__input_link{display:none}.b-share-popup__form{position:relative;display:none;overflow:hidden;padding:5px 0 0!important;margin:0 0 -15px;white-space:normal}.b-share-popup_show_form_mail .b-share-popup__form_mail,.b-share-popup_show_form_html .b-share-popup__form_html,.b-share-popup_show_form .b-share-popup__form{display:block}.b-share-popup__form__link{padding:5px!important;margin:0 0 5px 10px;text-decoration:underline;cursor:pointer;color:#1A3DC1}.b-share-popup__form__link,.b-share-popup__form__button{font:86%/1.4545em Verdana,sans-serif;float:left;display:inline}.b-share-popup__form__button{margin:5px 0 0 15px}.b-share-popup__form__close{font:86%/1.4545em Verdana,sans-serif;float:right;display:inline;padding:5px!important;margin:0 10px 5px 0;cursor:pointer;color:#999}a.b-share-popup__form__link:hover,a.b-share-popup__form__close:hover{text-decoration:underline;color:red}.b-share-popup_font_fixed .b-share-popup__item{font-size:12.8px}.b-share-popup_font_fixed .b-share-popup__header,.b-share-popup_font_fixed .b-share-popup__input,.b-share-popup_font_fixed .b-share-popup__expander .b-share-popup__item,.b-share-popup_font_fixed .b-share-popup__form__link,.b-share-popup_font_fixed .b-share-popup__form__button,.b-share-popup_font_fixed .b-share-popup__form__close{font-size:11px}.b-share-popup_font_fixed .b-share-popup__yandex{font-size:10px}.b-share-form-button{font:86%/17px Verdana,Arial,sans-serif;display:-moz-inline-box;display:inline-block;position:relative;height:19px;margin:0 3px;padding:0 4px;cursor:default;white-space:nowrap;text-decoration:none!important;color:#000!important;border:none;outline:none;background:url("//yastatic.net/share/static/b-share-form-button.png") 0 -20px repeat-x}.b-share-form-button:link:hover,.b-share-form-button:visited:hover{color:#000!important}.b-share-form-button__before,.b-share-form-button__after{position:absolute;width:3px;height:19px;background:url("//yastatic.net/share/static/b-share-form-button.png")}.b-share-form-button__before{margin-left:-7px}.b-share-form-button__after{margin-left:4px;background-position:-3px 0}.b-share-form-button::-moz-focus-inner{border:none}button.b-share-form-button .b-share-form-button__before,button.b-share-form-button .b-share-form-button__after{margin-top:-1px}@-moz-document url-prefix(){button.b-share-form-button .b-share-form-button__after{margin-top:-2px;margin-left:6px}button.b-share-form-button .b-share-form-button__before{margin-top:-2px;margin-left:-9px}}SPAN.b-share-form-button:hover,.b-share-form-button_state_hover{background-position:0 -60px}SPAN.b-share-form-button:hover .b-share-form-button__before,.b-share-form-button_state_hover .b-share-form-button__before{background-position:0 -40px}SPAN.b-share-form-button:hover .b-share-form-button__after,.b-share-form-button_state_hover .b-share-form-button__after{background-position:-3px -40px}.b-share-form-button_state_pressed,.b-share-form-button_state_pressed .b-share-form-button_share{background-position:0 -100px!important}.b-share-form-button_state_pressed .b-share-form-button__before{background-position:0 -80px!important}.b-share-form-button_state_pressed .b-share-form-button__after{background-position:-3px -80px!important}button.b-share-form-button_state_pressed{overflow:visible}.b-share-form-button_icons{position:relative;padding:0;background-position:0 -20px!important}.b-share-form-button_icons .b-share-form-button__before{left:0;margin-left:-3px;background-position:0 0!important}.b-share-form-button_icons .b-share-form-button__after{z-index:-1;margin-left:0;background-position:-3px 0!important}.b-share-form-button_icons .b-share__handle{padding:2px!important}.b-share-form-button_icons .b-share__handle_more{position:relative;padding-right:6px!important;margin-right:-4px}.b-share-form-button_icons .b-share-icon{opacity:.5;background-image:url("//yastatic.net/share/static/b-share-icon_size_14.png")}.b-share-form-button_icons A.b-share__handle:hover .b-share-icon{opacity:1}.b-share{font:86%/1.4545em Arial,sans-serif;display:-moz-inline-box;display:inline-block;padding:1px 3px 1px 4px!important;vertical-align:middle}.b-share .b-share-form-button{font-size:1em}.b-share__text .b-share-icon{margin:0 5px 0 0;border:none}.b-share__text{margin-right:5px}.b-share__handle{float:left;height:16px;padding:5px 3px 5px 2px!important;cursor:pointer;text-align:left;text-decoration:none!important}.b-share__handle_cursor_default{cursor:default}.b-share__handle .b-share-form-button{margin-top:-2px}.b-share__hr{display:none;float:left;width:1px;height:26px;margin:0 3px 0 2px}a.b-share__handle:hover .b-share__text{text-decoration:underline;color:red}.b-share_bordered{padding:0 2px 0 3px!important;border:1px solid #E4E4E4;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}.b-share_bordered .b-share__hr{display:inline;background:#E4E4E4}.b-share_link{margin:-8px 0}a.b-share_link{margin:0}.b-share_link .b-share__text{text-decoration:underline;color:#1A3DC1}.b-share-form-button_share{padding-left:26px!important;vertical-align:top}.b-share-form-button_share .b-share-form-button__before{margin-left:-29px}.b-share-form-button_share .b-share-form-button__icon{position:absolute;width:20px;height:17px;margin:1px 0 0 -23px;background:url("//yastatic.net/share/static/b-share-form-button_share__icon.png") 0 0 no-repeat}.b-share-pseudo-link{border-bottom:1px dotted;cursor:pointer;text-decoration:none!important}.b-share_font_fixed{font-size:11px}.b-share__handle_more{font-size:9px;margin-top:-1px;color:#7B7B7B}A.b-share__handle_more:hover{color:#000}.b-share__group{float:left}.b-share-icon{float:left;display:inline;overflow:hidden;width:16px;height:16px;padding:0!important;vertical-align:top;border:0;background:url("//yastatic.net/share/static/b-share-icon.png") 0 99px no-repeat}.b-share-icon_vkontakte,.b-share-icon_custom{background-position:0 0}.b-share-icon_yaru,.b-share-icon_yaru_photo,.b-share-icon_yaru_wishlist{background-position:0 -17px}.b-share-icon_lj{background-position:0 -34px}.b-share-icon_twitter{background-position:0 -51px}.b-share-icon_facebook{background-position:0 -68px}.b-share-icon_moimir{background-position:0 -85px}.b-share-icon_friendfeed{background-position:0 -102px}.b-share-icon_mail{background-position:0 -119px}.b-share-icon_html{background-position:0 -136px}.b-share-icon_postcard{background-position:0 -153px}.b-share-icon_odnoklassniki{background-position:0 -170px}.b-share-icon_blogger{background-position:0 -187px}.b-share-icon_delicious{background-position:0 -221px}.b-share-icon_gbuzz{background-position:0 -238px}.b-share-icon_linkedin{background-position:0 -255px}.b-share-icon_myspace{background-position:0 -272px}.b-share-icon_evernote{background-position:0 -289px}.b-share-icon_digg{background-position:0 -306px}.b-share-icon_juick{background-position:0 -324px}.b-share-icon_moikrug{background-position:0 -341px}.b-share-icon_yazakladki{background-position:0 -358px}.b-share-icon_liveinternet{background-position:0 -375px}.b-share-icon_tutby{background-position:0 -392px}.b-share-icon_diary{background-position:0 -409px}.b-share-icon_gplus{background-position:0 -426px}.b-share-icon_pocket{background-position:0 -443px}.b-share-icon_surfingbird{background-position:0 -460px}.b-share-icon_pinterest{background-position:0 -477px}.b-share-icon_renren{background-position:0 0}.b-share-icon_renren,.b-share-icon_sina_weibo{background:url("//yastatic.net/share/static/b-share-icon__china.png") no-repeat}.b-share-icon_sina_weibo{background-position:-18px 0}.b-share-icon_qzone{background-position:-36px 0}.b-share-icon_qzone,.b-share-icon_tencent_weibo{background:url("//yastatic.net/share/static/b-share-icon__china.png") no-repeat}.b-share-icon_tencent_weibo{background-position:-54px 0}.b-share_theme_dark .b-share-icon{background:url("//yastatic.net/share/static/b-share-icons__theme_dark.png") 99px 0 no-repeat}.b-share_theme_dark .b-share-icon_odnoklassniki{background-position:-4px -3px}.b-share_theme_dark .b-share-icon_vkontakte{background-position:-24px -3px}.b-share_theme_dark .b-share-icon_twitter{background-position:-44px -3px}.b-share_theme_dark .b-share-icon_facebook{background-position:-64px -3px}.b-share_theme_dark .b-share-icon_lj{background-position:-85px -3px}.b-share_theme_dark .b-share-icon_yaru{background-position:-105px -3px}.b-share_theme_dark .b-share-popup .b-share-icon_odnoklassniki,.b-share_theme_dark .b-share-icon_odnoklassniki:hover{background-position:-4px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_vkontakte,.b-share_theme_dark .b-share-icon_vkontakte:hover{background-position:-24px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_twitter,.b-share_theme_dark .b-share-icon_twitter:hover{background-position:-44px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_facebook,.b-share_theme_dark .b-share-icon_facebook:hover{background-position:-64px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_lj,.b-share_theme_dark .b-share-icon_lj:hover{background-position:-85px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_yaru,.b-share_theme_dark .b-share-icon_yaru:hover{background-position:-105px -28px}.b-share_theme_dark .b-share-form-button_share .b-share-form-button__icon{background-image:url("//yastatic.net/share/static/b-share-form-button_share__icon_dark.png")}.b-share_theme_dark .b-share-form-button{color:#fff!important;opacity:.8}.b-share_theme_dark .b-share__handle:hover .b-share-form-button,.b-share_theme_dark .b-share-form-button:hover{opacity:1;cursor:pointer}.b-share_theme_dark .b-share-form-button,.b-share_theme_dark .b-share-form-button__before,.b-share_theme_dark .b-share-form-button__after{background:0 0}.b-share_theme_dark .b-share-popup__i{background-color:#333;border-radius:10px;-webkit-box-shadow:0 2px 9px rgba(255,255,255,.6);-moz-box-shadow:0 2px 9px rgba(255,255,255,.6);box-shadow:0 2px 9px rgba(255,255,255,.6)}.b-share_theme_dark .b-share__text{color:#AAA}.b-share_theme_dark .b-share-popup{color:#AAA;border-radius:10px;background-color:#333;background-color:rgba(50,50,50,.3)}.b-share_theme_dark .b-share-popup__item{background:0 0;color:#ccc}.b-share_theme_dark .b-share-popup .b-share-popup__item__text{color:#ccc}.b-share_theme_counter .b-share{display:inline-block;vertical-align:middle;white-space:nowrap}.b-share-counter{font:14px Arial,sans-serif;line-height:18px;display:none;float:left;margin:3px 6px 3px 3px;color:#fff}.b-share_theme_counter .b-share_type_small .b-share-counter{font-size:11px;line-height:14px;margin:2px 6px 2px 1px}.b-share_theme_counter .b-share-btn__counter .b-share-counter{display:block}.b-share-btn__counter{text-decoration:none}.b-share_theme_counter .b-share-btn__wrap{position:relative;float:left;margin-left:5px}.b-share_theme_counter .b-share_type_small .b-share-btn__wrap{margin-left:4px}.b-share_theme_counter .b-share-btn__wrap:first-child{margin-left:0}.b-share_theme_counter .b-share__link{display:inline-block;cursor:pointer;-webkit-border-radius:3px;border-radius:3px}.b-share_theme_counter .b-share_type_small .b-share__link{-webkit-border-radius:2px;border-radius:2px}.b-share_theme_counter .b-share-icon{display:block;float:left;width:24px;height:24px;background-image:url("//yastatic.net/share/static/b-share_counter_large.png");background-position:-20px 0}.b-share_theme_counter .b-share_type_small .b-share-icon{width:18px;height:18px;background-image:url("//yastatic.net/share/static/b-share_counter_small.png")}.b-share_theme_counter .b-share-icon_facebook{background-position:0 0}.b-share_theme_counter .b-share-btn__facebook{background-color:#3c5a98}.b-share_theme_counter .b-share-btn__facebook:hover{background-color:#30487a}.b-share_theme_counter .b-share-btn__facebook:active{border-top:2px solid #24365a;background-color:#334d81}.b-share_theme_counter .b-share-icon_moimir{background-position:0 -29px}.b-share_theme_counter .b-share-btn__moimir{background-color:#226eb7}.b-share_theme_counter .b-share-btn__moimir:hover{background-color:#1b5892}.b-share_theme_counter .b-share-btn__moimir:active{border-top:2px solid #14426d;background-color:#1d5e9c}.b-share_theme_counter .b-share-icon_vkontakte{background-position:0 -58px}.b-share_theme_counter .b-share-btn__vkontakte{background-color:#48729e}.b-share_theme_counter .b-share-btn__vkontakte:hover{background-color:#3a5b7e}.b-share_theme_counter .b-share-btn__vkontakte:active{border-top:2px solid #2b445e;background-color:#3d6186}.b-share_theme_counter .b-share-icon_twitter{background-position:0 -87px}.b-share_theme_counter .b-share-btn__twitter{background-color:#00aced}.b-share_theme_counter .b-share-btn__twitter:hover{background-color:#008abe}.b-share_theme_counter .b-share-btn__twitter:active{border-top:2px solid #00668d;background-color:#0092ca}.b-share_theme_counter .b-share-icon_odnoklassniki{background-position:0 -116px}.b-share_theme_counter .b-share-btn__odnoklassniki{background-color:#ff9f4d}.b-share_theme_counter .b-share-btn__odnoklassniki:hover{background-color:#cc7f3e}.b-share_theme_counter .b-share-btn__odnoklassniki:active{border-top:2px solid #975e2e;background-color:#d98742}.b-share_theme_counter .b-share-icon_gplus{background-position:0 -145px}.b-share_theme_counter .b-share-btn__gplus{background-color:#c25234}.b-share_theme_counter .b-share-btn__gplus:hover{background-color:#9b422a}.b-share_theme_counter .b-share-btn__gplus:active{border-top:2px solid #73311f;background-color:#a5462c}.b-share_theme_counter .b-share-icon_yaru{background-position:0 -174px}.b-share_theme_counter .b-share-btn__yaru{background-color:#d83933}.b-share_theme_counter .b-share-btn__yaru:hover{background-color:#ad2e29}.b-share_theme_counter .b-share-btn__yaru:active{border-top:2px solid #80221e;background-color:#b8312b}.b-share_theme_counter .b-share-icon_pinterest{background-position:0 -203px}.b-share_theme_counter .b-share-btn__pinterest{background-color:#cd1e27}.b-share_theme_counter .b-share-btn__pinterest:hover{background-color:#a4181f}.b-share_theme_counter .b-share-btn__pinterest:active{border-top:2px solid #7b1217;background-color:#ae1921}.b-share_theme_counter .b-share__link:active{height:22px}.b-share_theme_counter .b-share_type_small .b-share__link:active{height:16px}.b-share_theme_counter .b-share__link:active .b-share-icon,.b-share_theme_counter .b-share__link:active .b-share-counter{position:relative;top:-1px}.b-share_theme_counter .b-share__link::after{position:absolute;top:0;right:0;bottom:0;left:0;content:"";background-image:url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)}.b-share_theme_counter .b-share__handle{height:auto;padding:0!important}</style><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f6f7f8;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3a5795;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;bottom:0;left:0;right:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #2f477a;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f8;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}</style></head>
<body><span style="display:none;" class="csrf-token" data-csrf="69ee2bd7d44d6e12dd066fadc0fc0172">&nbsp;</span>
<div class="button-up" style="opacity: 0.7; width: 30px; height: 100%; position: fixed; left: 0px; top: 0px; cursor: pointer; text-align: center; line-height: 30px; color: rgb(211, 219, 228); font-weight: bold; font-size: 20px; background: none;"><i class="icon-circle-arrow-up"></i></div>

<!-- Codeforces JavaScripts. -->
<script type="text/javascript">
    var queryMobile = Codeforces.queryString.mobile;
    if (queryMobile === "true" || queryMobile === "false") {
        Codeforces.putToStorage("useMobile", queryMobile == "true");
    } else {
        var useMobile = Codeforces.getFromStorage("useMobile");
        if (useMobile === true || useMobile === false) {
            if (useMobile != false) {
                Codeforces.redirect(Codeforces.updateUrlParameter(document.location.href, "mobile", useMobile));
            }
        }
    }
</script>
<script type="text/javascript">
    if (window.parent.frames.length > 0) {
        window.stop();
    }
</script>

    <script type="text/javascript">
        $(document).ready(function () {
    (function () {
        jQuery.expr[':'].containsCI = function(elem, index, match) {
            return !match || !match.length || match.length < 4 || !match[3] || (
                    elem.textContent || elem.innerText || jQuery(elem).text() || ''
            ).toLowerCase().indexOf(match[3].toLowerCase()) >= 0;
        }
    }(jQuery));

    $.ajaxPrefilter(function(options, originalOptions, xhr) {
        var csrf = Codeforces.getCsrfToken();

        if (csrf) {
            var data = originalOptions.data;
            if (originalOptions.data !== undefined) {
                if (Object.prototype.toString.call(originalOptions.data) === '[object String]') {
                    data = $.deparam(originalOptions.data);
                }
            } else {
                data = {};
            }
            options.data = $.param($.extend(data, { csrf_token: csrf }));
        }
    });

    window.getCodeforcesServerTime = function(callback) {
        $.post("/data/time", {}, callback, "json");
    }

    window.updateTypography = function () {
        $("div.ttypography code").addClass("tt");
        $("div.ttypography pre>code").addClass("prettyprint").removeClass("tt");
        $("div.ttypography table").addClass("bordertable");
        prettyPrint();
    }

    $.ajaxSetup({ scriptCharset: "utf-8" ,contentType: "application/x-www-form-urlencoded; charset=UTF-8", headers: {
        'X-Csrf-Token': Codeforces.getCsrfToken()
    }});

    window.updateTypography();

    Codeforces.signForms();

    setTimeout(function() {
        $(".second-level-menu-list").lavaLamp({
            fx: "backout",
            speed: 1000
        });
    }, 0);


    Codeforces.countdown();
    $("a[rel='photobox']").colorbox();

        var count = 0;

        function getDelay() {
            var delay = 0;
            var last = Codeforces.getFromStorage("LastOnlineTimeUpdaterMillis", 0);
            if (last && last != null) {
                var period = count < 20 ? 180 * 1000 : 360 * 1000;
                delay = period - (new Date().getTime() - last);
                if (delay < 0)
                    delay = 0;
            }
            return delay;
        }

        window.setInterval(function () {
            if (getDelay() <= 0 && count < 120) {
                ++count;
                Codeforces.ping("/data/update-online");
            }
        }, 5000);

        var handle = "f2013083";
        $("a.rated-user:contains(" + handle + "), span.participant:contains(" + handle + ")").each(function () {
            if ($(this).text() == handle) {
                var td = $(this).parent();
                var tr = $(this).parent().parent();
                if (td.is("td") && tr.is("tr")) {
                    tr.addClass("highlighted-row");
                }
            }
        });

    function showAnnouncements(json) {
        info("j=" + JSON.stringify(json));

        if (json.t != "a") {
            return;
        }
        console.log("Got announcement from channel");
        setTimeout(function() {
            Codeforces.showAnnouncements(json.d, "en");
        }, Math.random() * 500);
    }
    if (Codeforces.getParticipantChannel()) {
        Codeforces.subscribe(Codeforces.getParticipantChannel(), function(json) {
            showAnnouncements(json);
        });
    }

    if (Codeforces.getContestChannel()) {
        Codeforces.subscribe(Codeforces.getContestChannel(), function(json) {
            showAnnouncements(json);
        });
    }

    if (Codeforces.getGlobalChannel()) {
        Codeforces.subscribe(Codeforces.getGlobalChannel(), function(json) {
            showAnnouncements(json);
        });
    }

    if (Codeforces.getUserChannel()) {
        Codeforces.subscribe(Codeforces.getUserChannel(), function(json) {
            showAnnouncements(json);
        });
    }

    $(".clickable-title").click(function() {
        Codeforces.alert($(this).attr("title"));
    }).css("position", "relative").css("bottom", "3px");


    Codeforces.reformatTimes();
    Codeforces.initializePubSub();

    Codeforces.setupSpoilers();
        });
    </script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-743380-5']);
  _gaq.push(['_trackPageview']);

  (function () {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = (document.location.protocol == 'https:' ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<div id="body">
        
<div id="header" style="position: relative;">
    <div style="float:left;">
            <a href="http://codeforces.com/"><img src="./Efficient and easy segment trees - Codeforces_files/codeforces-logo-with-telegram.png"></a>
    </div>
    <div class="lang-chooser">
        <div style="text-align: right;">
            <a href="http://codeforces.com/blog/entry/18051?locale=en"><img src="./Efficient and easy segment trees - Codeforces_files/gb.png" title="In English" alt="In English"></a>
            <a href="http://codeforces.com/blog/entry/18051?locale=ru"><img src="./Efficient and easy segment trees - Codeforces_files/ru.png" title="По-русски" alt="По-русски"></a>
        </div>
        <div>
                <a href="http://codeforces.com/profile/f2013083">f2013083</a>
                 | 
                <a href="http://codeforces.com/af472ba066e46c24d78c741ea989279d/logout">Logout</a>
                
        </div>



    </div>
    <br style="clear: both;">
</div>


        

    <div class="roundbox menu-box" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
    <div class="menu-list-container">
    <ul class="menu-list main-menu-list">
                <li class=""><a href="http://codeforces.com/">Home</a></li>
                <li class=""><a href="http://codeforces.com/contests">Contests</a></li>
                <li class=""><a href="http://codeforces.com/gyms">Gym</a></li>
                <li class=""><a href="http://codeforces.com/problemset">Problemset</a></li>
                <li class=""><a href="http://codeforces.com/groups">Groups</a></li>
                <li class=""><a href="http://codeforces.com/ratings">Rating</a></li>
                <li class=""><a href="http://codeforces.com/api/help">API</a></li>
                <li class=""><a href="http://codeforces.com/vkcup2016">VK Cup <img class="icon" src="./Efficient and easy segment trees - Codeforces_files/cup.png"></a></li>
                <li class=""><a href="http://codeforces.com/croc2016">CROC <img class="icon" src="./Efficient and easy segment trees - Codeforces_files/cup.png"></a></li>
    </ul>
    <form method="post" action="http://codeforces.com/search"><input type="hidden" name="csrf_token" value="69ee2bd7d44d6e12dd066fadc0fc0172">
        <input class="search" name="query" data-isplaceholder="true" value="">
    <input type="hidden" name="_tta" value="810"></form>
    <br style="clear: both;">
</div>

    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $("input.search").focus(function () {
                if ($(this).attr("data-isPlaceholder") === "true") {
                    $(this).val("");
                    $(this).removeAttr("data-isPlaceholder");
                }
            });
        });
    </script>
            <br style="height: 3em; clear: both;">

        <div style="position: relative;">
                        <div id="sidebar">
    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">→ Pay attention
            <div class="top-links">
            </div>
        </div>
<div style="padding: 0.5em;">
        <div style="text-align:center;border-bottom: 1px solid rgb(185, 185, 185);margin:0 -0.5em 0.5em -0.5em;padding: 0 1em 0.5em 1em;">
            <span class="contest-state-phase">Before contest</span><br><a href="http://codeforces.com/contests/660">Educational Codeforces Round 11</a><br><span class="countdown" home="http://st.codeforces.com/s/95517" noredirection="true" textbeforeredirect="" cdid="i1">21:34:46</span>
        </div>
        <div style="text-align:center;">
            <div class="socials" style="text-align: left;">
                <div style="margin-top: 0.85em;position: relative;">

        <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="Facebook Cross Domain Communication Frame" aria-hidden="true" tabindex="-1" id="fb_xdm_frame_http" src="./Efficient and easy segment trees - Codeforces_files/xd_arbiter.html" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="Facebook Cross Domain Communication Frame" aria-hidden="true" tabindex="-1" id="fb_xdm_frame_https" src="./Efficient and easy segment trees - Codeforces_files/xd_arbiter(1).html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div>
        <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "http://connect.facebook.net/en_EN/all.js#appId=554666954583323&xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        </script>
        <div class="fb-like fb_iframe_widget" data-href="http://codeforces.com/contests/660" data-send="false" data-width="256" data-show-faces="false" data-font="arial" data-ref="53616" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=554666954583323&amp;container_width=264&amp;font=arial&amp;href=http%3A%2F%2Fcodeforces.com%2Fcontests%2F660&amp;locale=en_US&amp;ref=53616&amp;sdk=joey&amp;send=false&amp;show_faces=false&amp;width=256"><span style="vertical-align: bottom; width: 256px; height: 28px;"><iframe name="f27f28e39" width="256px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./Efficient and easy segment trees - Codeforces_files/like.html" style="border: none; visibility: visible; width: 256px; height: 28px;" class=""></iframe></span></div>

        </div>
</div>

        </div>
</div>
    </div>

    <style>
        .personal-sidebar {
            margin: 1em;
        }

        .personal-sidebar .for-avatar {
            float: right;
        }

        .personal-sidebar li {
            font-size: 0.8em;
        }

        .personal-sidebar .nav-links {
            margin-top: 0.5em;
        }

        .personal-sidebar .nav-links li {
            list-style: disc;
            list-style-position: inside;
        }
    </style>

    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">→ f2013083
            <div class="top-links">
            </div>
        </div>
    <div class="personal-sidebar">
<div class="for-avatar"><div class="avatar"><a href="http://codeforces.com/profile/f2013083"><img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg"></a><div><a href="http://codeforces.com/profile/f2013083" title="Unrated, f2013083" class="rated-user user-black">f2013083</a></div></div></div><div><ul><li><img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/star_blue_16.png" alt="User&#39;&#39;s contribution into Codeforces community" title="User&#39;&#39;s contribution into Codeforces community">&nbsp;

        Contribution:&nbsp;<span style="color:gray;font-weight:bold;">0</span></li></ul><ul class="nav-links"><li><a href="http://codeforces.com/settings/general">Settings</a></li><li><a href="http://codeforces.com/blog/f2013083">Blog</a></li><li><a href="http://codeforces.com/teams">Teams</a></li><li><a href="http://codeforces.com/submissions/f2013083">Submissions</a></li><li><a href="http://codeforces.com/usertalk">Talks</a></li><li><a href="http://codeforces.com/contests/with/f2013083">Contests</a></li></ul></div><br style="clear:both;">    </div>
    </div>

<div class="roundbox sidebox top-contributed" style="">
<div class="roundbox-lt">&nbsp;</div>
<div class="roundbox-rt">&nbsp;</div>
<div class="caption titled">→ Top rated
<div class="top-links">
</div>
</div>
<table class="rtable ">
<tbody>
<tr>
<th class="left" style="width:2.25em;">#</th>
<th class="">User</th>
<th class="" style="width:5em;">Rating</th>
</tr>
<tr>
<td class="left dark">1</td>
<td class=" dark"><a href="http://codeforces.com/profile/tourist" title="Legendary grandmaster tourist" class="rated-user user-legendary"><span class="legendary-user-first-letter">t</span>ourist</a></td>
<td class=" dark">3588</td>
</tr>
<tr>
<td class="left ">2</td>
<td class=""><a href="http://codeforces.com/profile/TooDifficuIt" title="Legendary grandmaster TooDifficuIt" class="rated-user user-legendary"><span class="legendary-user-first-letter">T</span>ooDifficuIt</a></td>
<td class="">3378</td>
</tr>
<tr>
<td class="left dark">3</td>
<td class=" dark"><a href="http://codeforces.com/profile/Petr" title="Legendary grandmaster Petr" class="rated-user user-legendary"><span class="legendary-user-first-letter">P</span>etr</a></td>
<td class=" dark">3342</td>
</tr>
<tr>
<td class="left ">4</td>
<td class=""><a href="http://codeforces.com/profile/rng_58" title="Legendary grandmaster rng_58" class="rated-user user-legendary"><span class="legendary-user-first-letter">r</span>ng_58</a></td>
<td class="">3102</td>
</tr>
<tr>
<td class="left dark">5</td>
<td class=" dark"><a href="http://codeforces.com/profile/izrak" title="Legendary grandmaster izrak" class="rated-user user-legendary"><span class="legendary-user-first-letter">i</span>zrak</a></td>
<td class=" dark">3073</td>
</tr>
<tr>
<td class="left ">6</td>
<td class=""><a href="http://codeforces.com/profile/jcvb" title="Legendary grandmaster jcvb" class="rated-user user-legendary"><span class="legendary-user-first-letter">j</span>cvb</a></td>
<td class="">3036</td>
</tr>
<tr>
<td class="left dark">7</td>
<td class=" dark"><a href="http://codeforces.com/profile/Um_nik" title="Legendary grandmaster Um_nik" class="rated-user user-legendary"><span class="legendary-user-first-letter">U</span>m_nik</a></td>
<td class=" dark">2994</td>
</tr>
<tr>
<td class="left ">8</td>
<td class=""><a href="http://codeforces.com/profile/vepifanov" title="Legendary grandmaster vepifanov" class="rated-user user-legendary"><span class="legendary-user-first-letter">v</span>epifanov</a></td>
<td class="">2985</td>
</tr>
<tr>
<td class="left dark">9</td>
<td class=" dark"><a href="http://codeforces.com/profile/Egor" title="Legendary grandmaster Egor" class="rated-user user-legendary"><span class="legendary-user-first-letter">E</span>gor</a></td>
<td class=" dark">2978</td>
</tr>
<tr>
<td class="left bottom">10</td>
<td class="bottom"><a href="http://codeforces.com/profile/RomaWhite" title="Legendary grandmaster RomaWhite" class="rated-user user-legendary"><span class="legendary-user-first-letter">R</span>omaWhite</a></td>
<td class="bottom">2976</td>
</tr>
</tbody>
</table>
<div class="bottom-links">
<table style="width:100%;">
<tbody>
<tr>
<td style="text-align:left;">
<a href="http://codeforces.com/ratings/countries">Countries</a> |
<a href="http://codeforces.com/ratings/cities">Cities</a> |
<a href="http://codeforces.com/ratings/organizations">Organizations</a>
</td>
<td style="text-align:right;">
<a href="http://codeforces.com/ratings">View all →</a>
</td>
</tr>
</tbody>
</table>
</div>
</div>

    <div class="roundbox sidebox top-contributed" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">→ Top contributors
            <div class="top-links">
            </div>
        </div>
        <table class="rtable ">
            <tbody>
                <tr>
                            <th class="left" style="width:2.25em;">#</th>
                            <th class="">User</th>
                            <th class="" style="width:5em;">Contrib.</th>
                </tr>
                    <tr>
                                <td class="left  dark">1</td>
                                <td class=" dark"><a href="http://codeforces.com/profile/Errichto" title="International Grandmaster Errichto" class="rated-user user-red">Errichto</a></td>
                                <td class=" dark">168</td>
                    </tr>
                    <tr>
                                <td class="left ">2</td>
                                <td class=""><a href="http://codeforces.com/profile/Zlobober" title="International Grandmaster Zlobober" class="rated-user user-red">Zlobober</a></td>
                                <td class="">164</td>
                    </tr>
                    <tr>
                                <td class="left  dark">3</td>
                                <td class=" dark"><a href="http://codeforces.com/profile/Petr" title="Legendary grandmaster Petr" class="rated-user user-legendary"><span class="legendary-user-first-letter">P</span>etr</a></td>
                                <td class=" dark">162</td>
                    </tr>
                    <tr>
                                <td class="left ">4</td>
                                <td class=""><a href="http://codeforces.com/profile/Edvard" title="Grandmaster Edvard" class="rated-user user-red">Edvard</a></td>
                                <td class="">157</td>
                    </tr>
                    <tr>
                                <td class="left  dark">5</td>
                                <td class=" dark"><a href="http://codeforces.com/profile/Xellos" title="International Grandmaster Xellos" class="rated-user user-red">Xellos</a></td>
                                <td class=" dark">155</td>
                    </tr>
                    <tr>
                                <td class="left ">6</td>
                                <td class=""><a href="http://codeforces.com/profile/amd" title="Grandmaster amd" class="rated-user user-red">amd</a></td>
                                <td class="">150</td>
                    </tr>
                    <tr>
                                <td class="left  dark">7</td>
                                <td class=" dark"><a href="http://codeforces.com/profile/chrome" title="Expert chrome" class="rated-user user-blue">chrome</a></td>
                                <td class=" dark">147</td>
                    </tr>
                    <tr>
                                <td class="left ">8</td>
                                <td class=""><a href="http://codeforces.com/profile/Swistakk" title="International Grandmaster Swistakk" class="rated-user user-red">Swistakk</a></td>
                                <td class="">146</td>
                    </tr>
                    <tr>
                                <td class="left  dark">9</td>
                                <td class=" dark"><a href="http://codeforces.com/profile/rng_58" title="Legendary grandmaster rng_58" class="rated-user user-legendary"><span class="legendary-user-first-letter">r</span>ng_58</a></td>
                                <td class=" dark">142</td>
                    </tr>
                    <tr>
                                <td class="left bottom">10</td>
                                <td class="bottom"><a href="http://codeforces.com/profile/Rubanenko" title="Candidate Master Rubanenko" class="rated-user user-violet">Rubanenko</a></td>
                                <td class="bottom">140</td>
                    </tr>
            </tbody>
        </table>
            <div class="bottom-links">
                <table style="width:100%;">
                    <tbody>
                        <tr>
                            <td style="text-align:left;">
                            </td>
                            <td style="text-align:right;">
                                    <a href="http://codeforces.com/top-contributed">View all →</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
        });
    </script>



    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">→ Find user
            <div class="top-links">
            </div>
        </div>
        <form class="handleForm" method="post" autocomplete="off"><input type="hidden" name="csrf_token" value="69ee2bd7d44d6e12dd066fadc0fc0172">
            <div style="padding:1em;text-align:right;">
                <label style="padding-right:1em;">Handle:
                    <input style="width:12em;" type="text" class="handleBox ac_input" autocomplete="off">
                </label>
            </div>
            <div style="padding: 0 1em 1em 1em;text-align:right;">
                <input style="height:1.65em;padding:0 0.75em;" type="submit" value="Find">
            </div>
        <input type="hidden" name="_tta" value="810"></form>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
    $(".handleBox").autocomplete("/data/handles", {
        delay: 200,
        width: 200,
        selectFirst: false,
        matchContains: true,
        minChars: 3
    });
    $(".handleForm").attr("autocomplete", "off").submit(function () {
        var link = "/profile/userHandle".replace(
            "userHandle", $(this).find(".handleBox").val()
        );
        window.location = link;
        return false;
    });
        });
    </script>


    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">→ Recent actions
            <div class="top-links">
            </div>
        </div>
        <div class="recent-actions">
            <ul>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Atef" title="Specialist Atef" class="rated-user user-cyan">Atef</a> →
        <a href="http://codeforces.com/blog/entry/44229">A Personalized Programming Competitions Calendar</a>
&nbsp;&nbsp;<img alt="Text created or updated" title="Text created or updated" src="./Efficient and easy segment trees - Codeforces_files/x-update-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/BrendonSlash" title="Newbie BrendonSlash" class="rated-user user-gray">BrendonSlash</a> →
        <a href="http://codeforces.com/blog/entry/44227">Handling floating points</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/adurysk" title="Master adurysk" class="rated-user user-orange">adurysk</a> →
        <a href="http://codeforces.com/blog/entry/44228">ICPC Preparatory Series — Preliminary contests results!</a>
&nbsp;&nbsp;<img alt="Text created or updated" title="Text created or updated" src="./Efficient and easy segment trees - Codeforces_files/x-update-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/chrome" title="Expert chrome" class="rated-user user-blue">chrome</a> →
        <a href="http://codeforces.com/blog/entry/44212">Topcoder Single Round Match 687</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/MikeMirzayanov" title="Headquarters, MikeMirzayanov" class="rated-user user-admin">MikeMirzayanov</a> →
        <a href="http://codeforces.com/blog/entry/44214">Codeforces: Rating Is Fixed (bug, go away!)</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/dead_lock" title="Unrated, dead_lock" class="rated-user user-black">dead_lock</a> →
        <a href="http://codeforces.com/blog/entry/44226">Diameter of Subtrees</a>
&nbsp;&nbsp;<img alt="Text created or updated" title="Text created or updated" src="./Efficient and easy segment trees - Codeforces_files/x-update-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/chaosagent" title="Expert chaosagent" class="rated-user user-blue">chaosagent</a> →
        <a href="http://codeforces.com/blog/entry/44054">USACO US Open</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/darkshadows" title="Candidate Master darkshadows" class="rated-user user-violet">darkshadows</a> →
        <a href="http://codeforces.com/blog/entry/20935">DP on Trees Tutorial</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/cappy" title="Specialist cappy" class="rated-user user-cyan">cappy</a> →
        <a href="http://codeforces.com/blog/entry/44213">Help — codeforces is blocked at work</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/tweety" title="Expert tweety" class="rated-user user-blue">tweety</a> →
        <a href="http://codeforces.com/blog/entry/44179">List of IOI 2016 Participants</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Nickolas" title="Expert Nickolas" class="rated-user user-blue">Nickolas</a> →
        <a href="http://codeforces.com/blog/entry/44222">TCO16 Marathon Round 1</a>
&nbsp;&nbsp;<img alt="Text created or updated" title="Text created or updated" src="./Efficient and easy segment trees - Codeforces_files/x-update-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Errichto" title="International Grandmaster Errichto" class="rated-user user-red">Errichto</a> →
        <a href="http://codeforces.com/blog/entry/43886">IndiaHacks Finals 2016 — Editorial</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/moaz123" title="Pupil moaz123" class="rated-user user-green">moaz123</a> →
        <a href="http://codeforces.com/blog/entry/44220">How is codeforces community helpful to you? </a>
&nbsp;&nbsp;<img alt="Text created or updated" title="Text created or updated" src="./Efficient and easy segment trees - Codeforces_files/x-update-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Swistakk" title="International Grandmaster Swistakk" class="rated-user user-red">Swistakk</a> →
        <a href="http://codeforces.com/blog/entry/44218">Congrats TopCoder Arena, that time has come</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/noblePrime" title="Pupil noblePrime" class="rated-user user-green">noblePrime</a> →
        <a href="http://codeforces.com/blog/entry/3119">How to increase the ratings...</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/sidhant" title="Expert sidhant" class="rated-user user-blue">sidhant</a> →
        <a href="http://codeforces.com/blog/entry/43499">Tutorial on FFT — The tough made simple.</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/amd" title="Grandmaster amd" class="rated-user user-red">amd</a> →
        <a href="http://codeforces.com/blog/entry/15890">Algorithm Gym :: Everything About Segment Trees</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/ahmed_aly" title="Candidate Master ahmed_aly" class="rated-user user-violet">ahmed_aly</a> →
        <a href="http://codeforces.com/blog/entry/44182">Google Code Jam 2016 Warmups</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Akylbek_Aitkali" title="Expert Akylbek_Aitkali" class="rated-user user-blue">Akylbek_Aitkali</a> →
        <a href="http://codeforces.com/blog/entry/44049">Congratulations!!!</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/waterfalls" title="Grandmaster waterfalls" class="rated-user user-red">waterfalls</a> →
        <a href="http://codeforces.com/blog/entry/44206">I mean... I'm not complaining — rating bug(?)</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/LegendaryGrandmaster" title="Specialist LegendaryGrandmaster" class="rated-user user-cyan">LegendaryGrandmaster</a> →
        <a href="http://codeforces.com/blog/entry/12707">Problem discussion: SPOJ Tower of Babylon (BABTWR)</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/aropan" title="Grandmaster aropan" class="rated-user user-red">aropan</a> →
        <a href="http://codeforces.com/blog/entry/43870">6th BSUIR Open Programming Contest</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/MikeMirzayanov" title="Headquarters, MikeMirzayanov" class="rated-user user-admin">MikeMirzayanov</a> →
        <a href="http://codeforces.com/blog/entry/79">About the programming languages</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/Nickolas" title="Expert Nickolas" class="rated-user user-blue">Nickolas</a> →
        <a href="http://codeforces.com/blog/entry/44141">April Fools Day Contest 2016: editorial</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
                        <li>
<div style="font-size:0.9em;padding:0.5em 0;">
    <a href="http://codeforces.com/profile/chrome" title="Expert chrome" class="rated-user user-blue">chrome</a> →
        <a href="http://codeforces.com/blog/entry/44036">Topcoder Single Round Match 686</a>
&nbsp;&nbsp;<img alt="New comment(s)" title="New comment(s)" src="./Efficient and easy segment trees - Codeforces_files/comment-12x12.png" style="vertical-align:middle;">
</div>
</li>
            </ul>
        </div>
            <div class="bottom-links">
                <table style="width:100%;">
                    <tbody>
                        <tr>
                            <td style="text-align:left;">
                            </td>
                            <td style="text-align:right;">
                                    <a href="http://codeforces.com/recent-actions">Detailed →</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
    </div>
</div>
                        <div id="pageContent" class="content-with-sidebar">
                    <div class="second-level-menu">
<ul class="second-level-menu-list"><li class="backLava" style="position: absolute; display: block; margin: 0px; padding: 0px; left: 52.8125px; top: 0px; width: 39px; height: 20px;"><div class="leftLava"></div><div class="bottomLava"></div><div class="cornerLava"></div></li>
        <li><a href="http://codeforces.com/profile/Al.Cash">Al.Cash</a></li>
        <li class="current selectedLava"><a href="http://codeforces.com/blog/Al.Cash">Blog</a></li>
        <li><a href="http://codeforces.com/teams/with/Al.Cash">Teams</a></li>
        <li><a href="http://codeforces.com/submissions/Al.Cash">Submissions</a></li>
        <li><a href="http://codeforces.com/groups/with/Al.Cash">Groups</a></li>
        <li><a href="http://codeforces.com/contests/with/Al.Cash">Contests</a></li>
</ul>
</div>
    <div style="margin-top:0;">
    <div>
        <h3><a href="http://codeforces.com/blog/Al.Cash" style="text-decoration:none;color:black !important;">Al.Cash's blog</a></h3>
    </div>
        <div style="margin-top:2em;">


<div class="topic" topicid="18113">
    <div class="title">
            <a href="http://codeforces.com/blog/entry/18051">            <p>Efficient and easy segment trees</p>
</a>
    </div>

    <div class="info" style="position:relative;">
            By&nbsp;<a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a>,
            <span class="format-humantime" title="May/23/2015 16:21 UTC+5.5">11 months ago</span>,
            
            <img style="position: relative;top: 5px;" src="./Efficient and easy segment trees - Codeforces_files/gb.png" alt="In English" title="In English">,

<a class="attach-blogEntry-18051-to-contest-link" href="http://codeforces.com/blog/entry/18051#"><img src="./Efficient and easy segment trees - Codeforces_files/paperclip-16x16.png" title="Attach this blog to some contest as a resource"></a>

<style type="text/css">
    .attach-blogEntry-18051-to-contest-form tr:not(:last-of-type) td {
        padding-bottom: 1em;
    }

    .blogEntry-18051-error {
        font-size: 1.1rem;
    }
</style>

<div class="attach-blogEntry-18051-to-contest-form-holder" style="display: none;padding: 1em;margin: 1em;">
    <form class="attach-blogEntry-18051-to-contest-form" method="post"><input type="hidden" name="csrf_token" value="69ee2bd7d44d6e12dd066fadc0fc0172">
        <table style="width: 100%;">
            <thead>
            </thead>
            <tbody>
        <tr class="subscription-row blogEntry-18051-blogId-error blogEntry-18051-error" style="display: none;">
            <td>&nbsp;</td>
        <td colspan="2"><div class="shiftUp">        <span class="error for__blogEntry-18051-blogId">-</span>
</div></td>
        </tr>
            <tr>
                <td style="width: 30%;"><label for="blogEntry-18051-contestId">Contest:</label></td>
                <td>
                    <select id="blogEntry-18051-contestId" name="contestId" style="width: 100%;float: left;" disabled="">
                        <option value=""></option>
                    </select>
                </td>
                <td>
                    <img id="blogEntry-18051-contestId-loading-indicator" src="./Efficient and easy segment trees - Codeforces_files/indicator.gif">
                </td>
            </tr>
        <tr class="subscription-row blogEntry-18051-contestId-error blogEntry-18051-error" style="display: none;">
            <td>&nbsp;</td>
        <td colspan="2"><div class="shiftUp">        <span class="error for__blogEntry-18051-contestId">-</span>
</div></td>
        </tr>
            <tr>
                <td style="width: 30%;"><label for="blogEntry-18051-resourceType">Type:</label></td>
                <td>
                    <select id="blogEntry-18051-resourceType" name="resourceType" style="width: 100%;">
                        <option value="" selected=""></option>
                        <option value="STATEMENT">statements</option>
                        <option value="TUTORIAL">tutorial</option>
                        <option value="ANNOUNCEMENT">announcement</option>
                        <option value="DISCUSSION">discussion</option>
                    </select>
                </td>
                <td></td>
            </tr>
        <tr class="subscription-row blogEntry-18051-resourceType-error blogEntry-18051-error" style="display: none;">
            <td>&nbsp;</td>
        <td colspan="2"><div class="shiftUp">        <span class="error for__blogEntry-18051-resourceType">-</span>
</div></td>
        </tr>
            <tr>
                <td colspan="2" style="text-align: center;">
                    <input type="submit" id="blogEntry-18051-resource-submit" value="Attach" disabled="" style="padding: 0.25em 0.5em;margin: 1em;width: 8em;">
                </td>
                <td>
                    <img id="blogEntry-18051-resource-submitting-indicator" src="./Efficient and easy segment trees - Codeforces_files/indicator.gif" style="display: none;">
                </td>
            </tr>
            </tbody>
        </table>
    <input type="hidden" name="_tta" value="810"></form>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(".blogEntry-18051-error").hide();

        $(".attach-blogEntry-18051-to-contest-link").click(function () {
            Codeforces.facebox(".attach-blogEntry-18051-to-contest-form-holder", "http://st.codeforces.com/s/95517");

            $("#facebox .attach-blogEntry-18051-to-contest-form").submit(function () {
                if ($(this).find(":disabled").length === 0) {
                    $("#facebox .blogEntry-18051-error").hide();
                    $("#facebox #blogEntry-18051-resource-submitting-indicator").show();
                    $("#facebox #blogEntry-18051-resource-submit").attr("disabled", "disabled");

                    //noinspection JSUnusedGlobalSymbols
                    $.post("/data/blogAndContest?action=attachBlogToContest", {
                        blogId:"3827", contestId:$("#facebox #blogEntry-18051-contestId").val(),
                        blogEntryId:"18051",
                        resourceType:$("#facebox #blogEntry-18051-resourceType").val()
                    }, function (json) {
                        var validated = true;

                        for (var key in json) {
                            if (json.hasOwnProperty(key) && key.indexOf("error__") === 0) {
                                validated = false;
                                $("#facebox .blogEntry-18051-" + key.substring("error__".length) + "-error").show();
                                $("#facebox .for__blogEntry-18051-" + key.substring("error__".length)).text(json[key]);
                            }
                        }

                        $("#facebox #blogEntry-18051-resource-submitting-indicator").hide();
                        $("#facebox #blogEntry-18051-resource-submit").removeAttr("disabled");

                        if (validated) {
                            $.facebox.close();
                            if (json["success"] === "true") {
                                Codeforces.showMessage("Blog has been successfully attached to selected contest");
                            } else {
                                Codeforces.showMessage("There is unexpected error while attaching blog to the contest");
                            }
                        }
                    }, "json");
                }

                return false;
            });

            var contestSelect = $("#blogEntry-18051-contestId");
            var popupContestSelect = $("#facebox #blogEntry-18051-contestId");

            if (popupContestSelect.is(":disabled")) {
                $.post("/data/contests?action=getContestListWithEditableResources", function (data) {
                    if (data["result"] === "success") {
                        var contests = data["contests"];

                        for (var i = 0, contestCount = contests.length; i < contestCount; ++i) {
                            //noinspection StringLiteralBreaksHTMLJS
                            var contestOptionHtml = "<option value=\"" + contests[i]["id"] + "\">"
                                    + contests[i]["id"] + " - " + contests[i]["name"] + "</option>";
                            contestSelect.append(contestOptionHtml);
                            popupContestSelect.append(contestOptionHtml);
                        }

                        contestSelect.removeAttr("disabled");
                        $("#blogEntry-18051-contestId-loading-indicator").hide();
                        $("#blogEntry-18051-resource-submit").removeAttr("disabled");

                        popupContestSelect.removeAttr("disabled");
                        $("#facebox #blogEntry-18051-contestId-loading-indicator").hide();
                        $("#facebox #blogEntry-18051-resource-submit").removeAttr("disabled");
                    } else {
                        alert("Can't receive contest list");
                    }
                }, "json");
            }

            return false;
        });
    });
</script>



        <span style="position:absolute;right:0;top:0.05em;margin-right:1em;display:inline;font-size:0.75em;">
            <div style="margin-top:0.25em;">
            </div>
        </span>
    </div>

    <div class="content">
        <div class="ttypography"><p>This is my first attempt at writing something useful, so your suggestions are welcome.</p><p>Most participants of programming contests are familiar with segment trees to some degree, especially having read this articles <a href="http://codeforces.com/blog/entry/15890">http://codeforces.com/blog/entry/15890</a>, <a href="http://e-maxx.ru/algo/segment_tree">http://e-maxx.ru/algo/segment_tree</a> (Russian only). If you're not — don't go there yet. I advise to read them after this article for the sake of examples, and to compare implementations and choose the one you like more (will be kinda obvious).</p><h1>Segment tree with single element modifications</h1><p>Let's start with a brief explanation of segment trees. They are used when we have an array, perform some changes and queries on continuous segments. In the first example we'll consider 2 operations:</p> <ol>   <li>modify one element in the array;</li>   <li>find the sum of elements on some segment. .</li> </ol><h3>Perfect binary tree</h3><p>I like to visualize a segment tree in the following way: <a href="http://i.imgur.com/GGBmcEP.png">image link</a></p><p><img alt=" " src="./Efficient and easy segment trees - Codeforces_files/0f52998b96c8a0f55d379fd5c990e5d2d66d1ab2.png" style="max-width: 100.0%;max-height: 100.0%;"></p><p>Notation is <em>node_index: corresponding segment</em> (left border included, right excluded). At the bottom row we have our array (0-indexed), the leaves of the tree. For now suppose it's length is a power of 2 (16 in the example), so we get perfect binary tree. When going up the tree we take pairs of nodes with indices <span class="tex-span">(2 * <i>i</i>, 2 * <i>i</i> + 1)</span> and combine their values in their parent with index <span class="tex-span"><i>i</i></span>. This way when we're asked to find a sum on interval <span class="tex-span">[3, 11)</span>, we need to sum up only values in the nodes 19, 5, 12 and 26 (marked with bold), not all 8 values inside the interval. Let's jump directly to implementation (in C++) to see how it works:</p> <pre><code class="prettyprint"><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e5</span><span class="pun">;</span><span class="pln">  </span><span class="com">// limit for array size</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">  </span><span class="com">// array size</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> N</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> build</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// build the tree</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// set value at position p</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&gt;&gt;</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">^</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// sum on interval [l, r)</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++];</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  scanf</span><span class="pun">(</span><span class="str">"%d"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> scanf</span><span class="pun">(</span><span class="str">"%d"</span><span class="pun">,</span><span class="pln"> t </span><span class="pun">+</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
  build</span><span class="pun">();</span><span class="pln">
  modify</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  printf</span><span class="pun">(</span><span class="str">"%d\n"</span><span class="pun">,</span><span class="pln"> query</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">));</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>That's it! Fully operational example. Forget about those cumbersome recursive functions with 5 arguments!</p><p>Now let's see why this works, and works very efficient.</p> <ol>   <li><p>As you could notice from the picture, leaves are stored in continuous nodes with indices starting with <span class="tex-span"><i>n</i></span>, element with index <span class="tex-span"><i>i</i></span> corresponds to a node with index <span class="tex-span"><i>i</i> + <i>n</i></span>. So we can read initial values directly into the tree where they belong.</p></li>   <li><p>Before doing any queries we need to build the tree, which is quite straightforward and takes <span class="tex-span"><i>O</i>(<i>n</i>)</span> time. Since parent always has index less than its children, we just process all the internal nodes in decreasing order. In case you're confused by bit operations, the code in <em>build()</em> is equivalent to <code class="tt">t[i] = t[2*i] + t[2*i+1]</code>.</p></li>   <li><p>Modifying an element is also quite straightforward and takes time proportional to the height of the tree, which is <span class="tex-span"><i>O</i>(<i>log</i>(<i>n</i>))</span>. We only need to update values in the parents of given node. So we just go up the tree knowing that parent of node <span class="tex-span"><i>p</i></span> is <span class="tex-span"><i>p</i> / 2</span> or <code class="tt">p&gt;&gt;1</code>, which means the same. <code class="tt">p^1</code> turns <span class="tex-span">2 * <i>i</i></span> into <span class="tex-span">2 * <i>i</i> + 1</span> and vice versa, so it represents the second child of <span class="tex-span"><i>p</i></span>'s parent.</p></li>   <li><p>Finding the sum also works in <span class="tex-span"><i>O</i>(<i>log</i>(<i>n</i>))</span> time. To better understand it's logic you can go through example with interval <span class="tex-span">[3, 11)</span> and verify that result is composed exactly of values in nodes 19, 26, 12 and 5 (in that order).</p></li> </ol><p>General idea is the following. If <span class="tex-span"><i>l</i></span>, the left interval border, is odd (which is equivalent to <code class="tt">l&amp;1</code>) then <span class="tex-span"><i>l</i></span> is the right child of its parent. Then our interval includes node <span class="tex-span"><i>l</i></span> but doesn't include it's parent. So we add <code class="tt">t[l]</code> and move to the right of <span class="tex-span"><i>l</i></span>'s parent by setting <span class="tex-span"><i>l</i> = (<i>l</i> + 1) / 2</span>. If <span class="tex-span"><i>l</i></span> is even, it is the left child, and the interval includes its parent as well (unless the right border interferes), so we just move to it by setting <span class="tex-span"><i>l</i> = <i>l</i> / 2</span>. Similar argumentation is applied to the right border. We stop once borders meet.</p><p>No recursion and no additional computations like finding the middle of the interval are involved, we just go through all the nodes we need, so this is very efficient.</p><h3>Arbitrary sized array</h3><p>For now we talked only about an array with size equal to some power of 2, so the binary tree was perfect. The next fact may be stunning, so prepare yourself.</p><p><strong>The code above works for any size <span class="tex-span"><i>n</i></span>.</strong></p><p>Explanation is much more complex than before, so let's focus first on the advantages it gives us.</p> <ol>   <li>Segment tree uses exactly <span class="tex-span">2 * <i>n</i></span> memory, not <span class="tex-span">4 * <i>n</i></span> like some other implementations offer.</li>   <li>Array elements are stored in continuous manner starting with index <span class="tex-span"><i>n</i></span>.</li>   <li>All operations are very efficient and easy to write.</li> </ol><p>You can skip the next section and just test the code to check that it's correct. But for those interested in some kind of explanation, here's how the tree for <span class="tex-span"><i>n</i> = 13</span> looks like: <a href="http://i.imgur.com/cwKpYH1.png">image link</a></p><p><img alt=" " src="./Efficient and easy segment trees - Codeforces_files/523e873ebb079a80c9538c4205c8c243c66058ed.png" style="max-width: 100.0%;max-height: 100.0%;"></p><p>It's not actually a single tree any more, but a set of perfect binary trees: with root <span class="tex-span">2</span> and height 4, root <span class="tex-span">7</span> and height 2, root <span class="tex-span">12</span> and height 2, root <span class="tex-span">13</span> and height 1. Nodes denoted by dashes aren't ever used in <em>query</em> operations, so it doesn't matter what's stored there. Leaves seem to appear on different heights, but that can be fixed by cutting the tree before the node <span class="tex-span">13</span> and moving its right part to the left. I believe the resulting structure can be shown to be isomorphic to a part of larger perfect binary tree with respect to operations we perform, and this is why we get correct results.</p><p>I won't bother with formal proof here, let's just go through the example with interval [0, 7). We have <span class="tex-span"><i>l</i> = 13, <i>r</i> = 20</span>, <code class="tt">l&amp;1 =&gt; add t[13]</code> and borders change to <span class="tex-span"><i>l</i> = 7, <i>r</i> = 10</span>. Again <code class="tt">l&amp;1 =&gt; add t[7]</code>, borders change to <span class="tex-span"><i>l</i> = 4, <i>r</i> = 5</span>, and suddenly nodes are at the same height. Now we have <code class="tt">r&amp;1 =&gt; add t[4 = --r]</code>, borders change to <span class="tex-span"><i>l</i> = 2, <i>r</i> = 2</span>, so we're finished.</p><h2>Modification on interval, single element access</h2><p>Some people begin to struggle and invent something too complex when the operations are inverted, for example:</p> <ol>   <li>add a value to all elements in some interval;</li>   <li>compute an element at some position.</li> </ol><p>But all we need to do in this case is to switch the code in methods <em>modify</em> and <em>query</em> as follows:</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>If at some point after modifications we need to inspect all the elements in the array, we can push all the modifications to the leaves using the following code. After that we can just traverse elements starting with index <span class="tex-span"><i>n</i></span>. This way we reduce the complexity from <span class="tex-span"><i>O</i>(<i>nlog</i>(<i>n</i>))</span> to <span class="tex-span"><i>O</i>(<i>n</i>)</span> similarly to using <em>build</em> instead of n modifications.</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> push</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
    t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Note, however, that code above works only in case the order of modifications on a single element doesn't affect the result. Assignment, for example, doesn't satisfy this condition. Refer to section about lazy propagation for more information.</p><h2>Non-commutative combiner functions</h2><p>For now we considered only the simplest combiner function — addition. It is commutative, which means the order of operands doesn't matter, we have <span class="tex-span"><i>a</i> + <i>b</i> = <i>b</i> + <i>a</i></span>. The same applies to <span class="tex-span"><i>min</i></span> and <span class="tex-span"><i>max</i></span>, so we can just change all occurrences of <code class="tt">+</code> to one of those functions and be fine. But don't forget to initialize query result to infinity instead of 0.</p><p>However, there are cases when the combiner isn't commutative, for example, in the problem <a href="http://codeforces.com/contest/380/problem/C" title="Codeforces Round 223 (Div. 1)">380C - Sereja and Brackets</a>, tutorial available here <a href="http://codeforces.com/blog/entry/10363">http://codeforces.com/blog/entry/10363</a>. Fortunately, our implementation can easily support that. We define structure <code class="tt">S</code> and <em>combine</em> function for it. In method <em>build</em> we just change <code class="tt">+</code> to this function. In <em>modify</em> we need to ensure the correct ordering of children, knowing that left child has even index. When answering the query, we note that nodes corresponding to the left border are processed from left to right, while the right border moves from right to left. We can express it in the code in the following way:</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> S</span><span class="pun">&amp;</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> combine</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

S query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  S resl</span><span class="pun">,</span><span class="pln"> resr</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> resl </span><span class="pun">=</span><span class="pln"> combine</span><span class="pun">(</span><span class="pln">resl</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++]);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> resr </span><span class="pun">=</span><span class="pln"> combine</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">],</span><span class="pln"> resr</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> combine</span><span class="pun">(</span><span class="pln">resl</span><span class="pun">,</span><span class="pln"> resr</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre><h1>Lazy propagation</h1><p>Next we'll describe a technique to perform both range queries and range modifications, which is called lazy propagation. First, we need more variables:</p> <pre><code class="prettyprint"><span class="kwd">int</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> __builtin_clz</span><span class="pun">(</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">N</span><span class="pun">];</span><span class="pln">  </span></code></pre><p><span class="tex-span"><i>h</i></span> is a height of the tree, the highest significant bit in <span class="tex-span"><i>n</i></span>. <code class="tt">d[i]</code> is a delayed operation to be propagated to the children of node <span class="tex-span"><i>i</i></span> when necessary (this should become clearer from the examples). Array size if only <code class="tt">N</code> because we don't have to store this information for leaves — they don't have any children. This leads us to a total of <span class="tex-span">3 * <i>n</i></span> memory use.</p><p>Previously we could say that <code class="tt">t[i]</code> is a value corresponding to it's segment. Now it's not entirely true — first we need to apply all the delayed operations on the route from node <span class="tex-span"><i>i</i></span> to the root of the tree (parents of node <span class="tex-span"><i>i</i></span>). We assume that <code class="tt">t[i]</code> already includes <code class="tt">d[i]</code>, so that route starts not with <span class="tex-span"><i>i</i></span> but with its direct parent.</p><p>Let's get back to our first example with interval <span class="tex-span">[3, 11)</span>, but now we want to modify all the elements inside this interval. In order to do that we modify <code class="tt">t[i]</code> and <code class="tt">d[i]</code> at the nodes 19, 5, 12 and 26. Later if we're asked for a value for example in node 22, we need to propagate modification from node 5 down the tree. Note that our modifications could affect <code class="tt">t[i]</code> values up the tree as well: node 19 affects nodes 9, 4, 2 and 1, node 5 affects 2 and 1. Next fact is critical for the complexity of our operations:</p><p><strong>Modification on interval <span class="tex-span">[<i>l</i>, <i>r</i>)</span> affects <code class="tt">t[i]</code> values only in the parents of border leaves: <code class="tt">l+n</code> and <code class="tt">r+n-1</code> (except the values that compose the interval itself — the ones accessed in <em>for</em> loop).</strong></p><p>The proof is simple. When processing the left border, the node we modify in our loop is always the right child of its parent. Then all the previous modifications were made in the subtree of the left child of the same parent. Otherwise we would process the parent instead of both its children. This means current direct parent is also a parent of leaf <code class="tt">l+n</code>. Similar arguments apply to the right border.</p><p>OK, enough words for now, I think it's time to look at concrete examples.</p><h3>Increment modifications, queries for maximum</h3><p>This is probably the simplest case. The code below is far from universal and not the most efficient, but it's a good place to start.</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> apply</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> build</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">p</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> push</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> h</span><span class="pun">;</span><span class="pln"> s </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">s</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> p </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      apply</span><span class="pun">(</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
      apply</span><span class="pun">(</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
      d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> inc</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> l0 </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r0 </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(</span><span class="pln">l</span><span class="pun">++,</span><span class="pln"> value</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(--</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  build</span><span class="pun">(</span><span class="pln">l0</span><span class="pun">);</span><span class="pln">
  build</span><span class="pun">(</span><span class="pln">r0 </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">l</span><span class="pun">);</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2e9</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++]);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">],</span><span class="pln"> res</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Let's analyze it one method at a time. The first three are just helper methods user doesn't really need to know about.</p> <ol>   <li><p>Now that we have 2 variables for every internal node, it's useful to write a method to <em>apply</em> changes to both of them. <span class="tex-span"><i>p</i> &lt; <i>n</i></span> checks if <span class="tex-span"><i>p</i></span> is not a leaf. Important property of our operations is that if we increase all the elements in some interval by one value, maximum will increase by the same value.</p></li>   <li><p><em>build</em> is designed to update all the parents of a given node.</p></li>   <li><p><em>push</em> propagates changes from all the parents of a given node down the tree starting from the root. This parents are exactly the prefixes of <span class="tex-span"><i>p</i></span> in binary notation, that's why we use binary shifts to calculate them.</p></li> </ol><p>Now we're ready to look at main methods.</p> <ol>   <li><p>As explained above, we process increment request using our familiar loop and then updating everything else we need by calling <em>build</em>.</p></li>   <li><p>To answer the query, we use the same loop as earlier, but before that we need to push all the changes to the nodes we'll be using. Similarly to <em>build</em>, it's enough to push changes from the parents of border leaves.</p></li> </ol><p>It's easy to see that all operations above take <span class="tex-span"><i>O</i>(<i>log</i>(<i>n</i>))</span> time.</p><p>Again, this is the simplest case because of two reasons:</p> <ol>   <li>order of modifications doesn't affect the result;</li>   <li>when updating a node, we don't need to know the length of interval it represents.</li> </ol><p>We'll show how to take that into account in the next example.</p><h3>Assignment modifications, sum queries</h3><p>This example is inspired by problem <a href="http://acm.timus.ru/problem.aspx?space=1&amp;num=2042">Timus 2042</a></p><p>Again, we'll start with helper functions. Now we have more of them:</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> calc</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">else</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> apply</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value </span><span class="pun">*</span><span class="pln"> k</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>These are just simple <span class="tex-span"><i>O</i>(1)</span> functions to calculate value at node <span class="tex-span"><i>p</i></span> and to apply a change to the node. But there are two thing to explain:</p> <ol>   <li><p>We suppose there's a value we never use for modification, in our case it's <span class="tex-span">0</span>. In case there's no such value — we would create additional boolean array and refer to it instead of checking <code class="tt">d[p] == 0</code>.</p></li>   <li><p>Now we have additional parameter <span class="tex-span"><i>k</i></span>, which stands for the lenght of the interval corresponding to node <span class="tex-span"><i>p</i></span>. We will use this name consistently in the code to preserve this meaning. Obviously, it's impossible to calculate the sum without this parameter. We can avoid passing this parameter if we precalculate this value for every node in a separate array or calculate it from the node index on the fly, but I'll show you a way to avoid using extra memory or calculations.</p></li> </ol><p>Next we need to update <em>build</em> and <em>push</em> methods. Note that we have two versions of them: one we introduces earlier that processes the whole tree in <span class="tex-span"><i>O</i>(<i>n</i>)</span>, and one from the last example that processes just the parents of one leaf in <span class="tex-span"><i>O</i>(<i>log</i>(<i>n</i>))</span>. We can easily combine that functionality into one method and get even more.</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> build</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> l</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> push</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> h</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">h</span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> s </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">s</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> r </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      apply</span><span class="pun">(</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
      apply</span><span class="pun">(</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
      d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Both this methods work on any interval in <span class="tex-span"><i>O</i>(<i>log</i>(<i>n</i>) + |<i>r</i> - <i>l</i>|)</span> time. If we want to transform some interval in the tree, we can write code like this:</p> <pre><code class="prettyprint"><span class="pln">push</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
</span><span class="pun">...</span><span class="pln">  </span><span class="com">// do anything we want with elements in interval [l, r)</span><span class="pln">
build</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span></code></pre><p>Let's explain how they work. First, note that we change our interval to closed by doing <code class="tt">r += n-1</code> in order to calculate parents properly. Since we process our tree level by level, is't easy to maintain current interval level, which is always a power of 2. <em>build</em> goes bottom to top, so we initialize <span class="tex-span"><i>k</i></span> to 2 (not to 1, because we don't calculate anything for the leaves but start with their direct parents) and double it on each level. <em>push</em> goes top to bottom, so <span class="tex-span"><i>k</i></span>'s initial value depends here on the height of the tree and is divided by 2 on each level.</p><p>Main methods don't change much from the last example, but <em>modify</em> has 2 things to notice:</p> <ol>   <li>Because the order of modifications is important, we need to make sure there are no old changes on the paths from the root to all the nodes we're going to update. This is done by calling <em>push</em> first as we did in <em>query</em>.</li>   <li>We need to maintain the value of <span class="tex-span"><i>k</i></span>.</li> </ol> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> l0 </span><span class="pun">=</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> r0 </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">&lt;&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(</span><span class="pln">l</span><span class="pun">++,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(--</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  build</span><span class="pun">(</span><span class="pln">l0</span><span class="pun">,</span><span class="pln"> l0 </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  build</span><span class="pun">(</span><span class="pln">r0 </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r0</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++];</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>One could notice that we do 3 passed in <em>modify</em> over almost the same nodes: 1 down the tree in <em>push</em>, then 2 up the tree. We can eliminate the last pass and calculate new values only where it's necessary, but the code gets more complicated:</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> l </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  push</span><span class="pun">(</span><span class="pln">r </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">bool</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> cr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">&lt;&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cl</span><span class="pun">)</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">l </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(</span><span class="pln">l</span><span class="pun">++,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">),</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> apply</span><span class="pun">(--</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">),</span><span class="pln"> cr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(--</span><span class="pln">l</span><span class="pun">;</span><span class="pln"> r </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">&lt;&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cl</span><span class="pun">)</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cr </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">cl </span><span class="pun">||</span><span class="pln"> l </span><span class="pun">!=</span><span class="pln"> r</span><span class="pun">))</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Boolean flags denote if we already performed any changes to the left and to the right. Let's look at an example: <a href="http://i.imgur.com/CG6aftV.png">image link</a></p><p><img alt=" " src="./Efficient and easy segment trees - Codeforces_files/e3d2b2814d185dcb1f3f170414933e8b4c79df27.png" style="max-width: 100.0%;max-height: 100.0%;"></p><p>We call <em>modify</em> on interval <span class="tex-span">[4, 13)</span>:</p> <ol>   <li><span class="tex-span"><i>l</i> = 20, <i>r</i> = 29</span>, we call <em>apply(28)</em>;</li>   <li><span class="tex-span"><i>l</i> = 10, <i>r</i> = 14</span>, we call <em>calc(14)</em> — first node to the right of current interval is exactly the parent of last modified node;</li>   <li><span class="tex-span"><i>l</i> = 5, <i>r</i> = 7</span>, we call <em>calc(7)</em> and then <em>apply(5)</em> and <em>apply(6)</em>;</li>   <li><span class="tex-span"><i>l</i> = 3, <i>r</i> = 3</span>, so the first loop finishes.</li> </ol><p>Now you should see the point of doing <code class="tt">--l</code>, because we still need to calculate new values in nodes 2, 3 and then 1. End condition is <code class="tt">r &gt; 0</code> because it's possible to get <span class="tex-span"><i>l</i> = 1, <i>r</i> = 1</span> after the first loop, so we need to update the root, but <code class="tt">--l</code> results in <span class="tex-span"><i>l</i> = 0</span>.</p><p>Compared to previous implementation, we avoid unnecessary calls <em>calc(10)</em>, <em>calc(5)</em> and duplicate call to <em>calc(1)</em>.</p></div>
    </div>


        <div style="font-size: 1.1rem;line-height: 11px;">
            <img style="vertical-align: middle;" src="./Efficient and easy segment trees - Codeforces_files/tags.png" title="Tags" alt="Tags">
                <span style="padding: 0 0.35em;">
    <a href="http://codeforces.com/search?query=efficiency" class="tag notice" style="text-decoration: none;">efficiency</a>,
                </span>
                <span style="padding: 0 0.35em;">
    <a href="http://codeforces.com/search?query=segment%20trees" class="tag notice" style="text-decoration: none;">segment trees</a>
                </span>
        </div>

    <div class="roundbox meta" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
        <div class="left-meta">
            <ul>
                    <li>        <a href="http://codeforces.com/blog/entry/18051#" class="topic-vote-up-18113"><img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/voteup.png" alt="Vote: I like it" title="Vote: I like it"></a>
        &nbsp;


        <a href="http://codeforces.com/blog/entry/18051#" class="topic-vote-up-18113">
        
        </a>
</li>
                    <li>

        
        <span title="Topic rating" style="font-size:larger;font-weight:bold;color:green">+354</span>
        
</li>
                    <li>        <a href="http://codeforces.com/blog/entry/18051#" class="topic-vote-down-18113"><img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/votedown.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
        &nbsp;


        <a href="http://codeforces.com/blog/entry/18051#" class="topic-vote-down-18113">
        
        </a>
</li>
            </ul>
        </div>

        <div class="yashare-auto-init" style="display: inline; position: relative; top: 5px; left: 0;" data-yasharel10n="en" data-yasharetype="none" data-yasharelink="http://codeforces.com/blog/entry/18051" data-yasharetitle="Codeforces: Efficient and easy segment trees" data-yasharequickservices="vkontakte,facebook,twitter,lj"><span class="b-share"><a rel="nofollow" target="_blank" title="VKontakte" class="b-share__handle b-share__link b-share-btn__vkontakte" href="https://share.yandex.net/go.xml?service=vkontakte&amp;url=http%3A%2F%2Fcodeforces.com%2Fblog%2Fentry%2F18051&amp;title=Codeforces%3A%20Efficient%20and%20easy%20segment%20trees" data-service="vkontakte"><span class="b-share-icon b-share-icon_vkontakte"></span></a><a rel="nofollow" target="_blank" title="Facebook" class="b-share__handle b-share__link b-share-btn__facebook" href="https://share.yandex.net/go.xml?service=facebook&amp;url=http%3A%2F%2Fcodeforces.com%2Fblog%2Fentry%2F18051&amp;title=Codeforces%3A%20Efficient%20and%20easy%20segment%20trees" data-service="facebook"><span class="b-share-icon b-share-icon_facebook"></span></a><a rel="nofollow" target="_blank" title="Twitter" class="b-share__handle b-share__link b-share-btn__twitter" href="https://share.yandex.net/go.xml?service=twitter&amp;url=http%3A%2F%2Fcodeforces.com%2Fblog%2Fentry%2F18051&amp;title=Codeforces%3A%20Efficient%20and%20easy%20segment%20trees" data-service="twitter"><span class="b-share-icon b-share-icon_twitter"></span></a><a rel="nofollow" target="_blank" title="LiveJournal" class="b-share__handle b-share__link b-share-btn__lj" href="https://share.yandex.net/go.xml?service=lj&amp;url=http%3A%2F%2Fcodeforces.com%2Fblog%2Fentry%2F18051&amp;title=Codeforces%3A%20Efficient%20and%20easy%20segment%20trees" data-service="lj"><span class="b-share-icon b-share-icon_lj"></span></a></span></div>

        <span style="position: relative; top: 7px; left: 0.8em;">

    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="BLOG_ENTRY" data-entityid="18051" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

        </span>

        <div class="right-meta">
            <ul>
                    <li>        <a href="http://codeforces.com/profile/Al.Cash"><img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/user_16x16.png" alt="Author" title="Author"></a>
        &nbsp;


        <a href="http://codeforces.com/profile/Al.Cash">
        Al.Cash
        </a>
</li>
                    <li>        <img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/date_16x16.png" alt="Publication date" title="Publication date">
        &nbsp;


        
        <span class="format-humantime" title="May/23/2015 16:21 UTC+5.5">11 months ago</span>
        
</li>
                    <li>        <a href="http://codeforces.com/blog/entry/18051#comments"><img style="vertical-align:middle;position:relative;top:-0.2em;" src="./Efficient and easy segment trees - Codeforces_files/comments_16x16.png" alt="Comments" title="Comments"></a>
        &nbsp;


        <a href="http://codeforces.com/blog/entry/18051#comments">
        88
        </a>
</li>
            </ul>
        </div>

        <br style="clear:both;">
    </div>


<div class="comments" commentableid="18130">
    <div class="title">
        <img src="./Efficient and easy segment trees - Codeforces_files/comments-48x48.png" alt="Comments" title="Comments" style="position:relative;top:0.6em;">
        <a name="comments">Comments (88)</a>
    </div>
    <div><a href="http://codeforces.com/blog/entry/18051#" class="new-root-comment" style="float:right;position:relative;bottom:3.25em;">Write comment?</a></div>

<div class="comment">
    <table class="comment-table" commentid="229839" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Alex7">
<img src="./Efficient and easy segment trees - Codeforces_files/138d308e82273ec2.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Alex7" title="Candidate Master Alex7" class="rated-user user-violet">Alex7</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 03:55 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229839" href="http://codeforces.com/blog/entry/18051?#comment-229839" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229839" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229839" data-commentrating="4" data-commentuserid="83114">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+4</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229839">
                    <div class="moveup">
                    <div class="ttypography"><p>Is lazy propagation possible this way?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229839 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229839 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229839">
            <li>
<div class="comment">
    <table class="comment-table" commentid="229841" commentparentid="229839">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 04:29 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229841" href="http://codeforces.com/blog/entry/18051?#comment-229841" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229839" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229841" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

    <script type="text/javascript">
        $(document).ready(function () {
            $("img.toggle-favourite").click(function () {
                var size = $(this).attr("data-size");
                var img = $(this);

                var isFavourite = !img.hasClass("remove-favourite");
                var type = img.attr("data-type");
                var entityId = img.attr("data-entityId");

                $.post("/data/favourite",
                        { entityId: entityId, type: type, isFavourite: isFavourite },
                        function(response) {
                            if (response["success"] != "true") {
                                alert(response["message"]);
                            } else {
                                if (img.hasClass("remove-favourite")) {
                                    img.attr("src", "http://st.codeforces.com/s/95517/images/icons/star_gray_" + size + ".png");
                                    img.removeClass("remove-favourite");
                                    img.addClass("add-favourite");
                                } else {
                                    img.attr("src", "http://st.codeforces.com/s/95517/images/icons/star_yellow_" + size + ".png");
                                    img.removeClass("add-favourite");
                                    img.addClass("remove-favourite");
                                }
                            }
                        }, "json"
                );

                return false;
            });
        });
    </script>
</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229841" data-commentrating="8" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+8</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229841">
                    <div class="moveup">
                    <div class="ttypography"><p>Of course. Modification is more complex of course, but almost all principles are already described.</p><p>I just want to polish the implementation before posting.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229841 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229841 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229841">
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="229984" commentparentid="229839">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/raihatneloy">
<img src="./Efficient and easy segment trees - Codeforces_files/e356a8bb8191cdd.jpg">        </a>
        <div><a href="http://codeforces.com/profile/raihatneloy" title="Expert raihatneloy" class="rated-user user-blue">raihatneloy</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 21:59 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229984" href="http://codeforces.com/blog/entry/18051?#comment-229984" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229839" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229984" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229984" data-commentrating="0" data-commentuserid="50275">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229984">
                    <div class="moveup">
                    <div class="ttypography"><p>i most of the time use this method of segment tree &amp; i also coded lazy propagation! :)</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229984 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229984 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229984">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="229840" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/cmd">
<img src="./Efficient and easy segment trees - Codeforces_files/8764f5c091d4152d.jpg">        </a>
        <div><a href="http://codeforces.com/profile/cmd" title="Candidate Master cmd" class="rated-user user-violet">cmd</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 04:16 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229840" href="http://codeforces.com/blog/entry/18051?#comment-229840" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229840" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229840" data-commentrating="23" data-commentuserid="195">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+23</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229840">
                    <div class="moveup">
                    <div class="ttypography"><p>Also for reference: <a class="rated-user user-blue" href="http://codeforces.com/profile/Urbanowicz" title="Expert Urbanowicz">Urbanowicz</a>'s post about non-recursive segment tree implementation: <a href="https://codeforces.com/blog/entry/1256">https://codeforces.com/blog/entry/1256</a></p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229840 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229840 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229840">
            <li>
<div class="comment">
    <table class="comment-table" commentid="229899" commentparentid="229840">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/rajon_aust">
<img src="./Efficient and easy segment trees - Codeforces_files/704696dbd015d57d.jpg">        </a>
        <div><a href="http://codeforces.com/profile/rajon_aust" title="Expert rajon_aust" class="rated-user user-blue">rajon_aust</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 15:30 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229899" href="http://codeforces.com/blog/entry/18051?#comment-229899" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229840" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229899" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229899" data-commentrating="0" data-commentuserid="95185">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229899">
                    <div class="moveup">
                    <div class="ttypography"><p>Thanks ! First time I know something new that segment tree with no-recursive .</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229899 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229899 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229899">
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="229903" commentparentid="229840">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 16:24 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229903" href="http://codeforces.com/blog/entry/18051?#comment-229903" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229840" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229903" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229903" data-commentrating="12" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+12</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229903">
                    <div class="moveup">
                    <div class="ttypography"><p>True, my implementation is basically a refinement of the one in that post and in [user:Alias,2015-05-26]'s comment to that post. But for some reason it's still not well known and not really searchable, and I wasn't aware of that post. Also I hope to provide more knowledge, especially after I add the section about lazy propagation.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229903 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229903 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229903">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="229994" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/rng_58">
<img src="./Efficient and easy segment trees - Codeforces_files/12337379adfa9a4c.jpg">        </a>
        <div><a href="http://codeforces.com/profile/rng_58" title="Legendary grandmaster rng_58" class="rated-user user-legendary"><span class="legendary-user-first-letter">r</span>ng_58</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/26/2015 22:30 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-229994" href="http://codeforces.com/blog/entry/18051?#comment-229994" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="229994" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="229994" data-commentrating="41" data-commentuserid="733">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+41</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-229994">
                    <div class="moveup">
                    <div class="ttypography"><p>Just wondering, how did you write codes like this?</p><p>for (t[p += n] = value; p &gt; 1; p &gt;&gt;= 1) t[p&gt;&gt;1] = t[p] + t[p^1];</p><p>Did you write it in the first attempt or you wrote something else and compressed that?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-229994 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-229994 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-229994">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230071" commentparentid="229994">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 00:28 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230071" href="http://codeforces.com/blog/entry/18051?#comment-230071" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229994" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230071" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230071" data-commentrating="8" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+8</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230071">
                    <div class="moveup">
                    <div class="ttypography"><p>I don't remember, but of course it wasn't the first version, the code was revisited several times.</p><p>I think at first it looked like the code as I posted for non-commutative combiners, which is also used in <em>build</em> method.</p><p>^1 trick is used in max flow implementation where edge is stored adjacent to it's reverse, so we can use ^1 to get from one to another. I'm not sure, but probably it came from there.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230071 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230071 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230071">
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="230332" commentparentid="229994">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/KADR">
<img src="./Efficient and easy segment trees - Codeforces_files/9089397f80c0fe42.jpg">        </a>
        <div><a href="http://codeforces.com/profile/KADR" title="Grandmaster KADR" class="rated-user user-red">KADR</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 07:57 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230332" href="http://codeforces.com/blog/entry/18051?#comment-230332" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-229994" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230332" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230332" data-commentrating="19" data-commentuserid="1028">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+19</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230332">
                    <div class="moveup">
                    <div class="ttypography"><p>I believe smth like this is more understandable and is equivalently short:</p> <pre><code class="prettyprint"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">[</span><span class="pln">p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span></code></pre></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230332 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230332 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230332">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230372" commentparentid="230332">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 13:09 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230372" href="http://codeforces.com/blog/entry/18051?#comment-230372" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230332" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230372" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230372" data-commentrating="10" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+10</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230372">
                    <div class="moveup">
                    <div class="ttypography"><p>Well, it's a matter of style. I prefer not to write modifications inside a loop condition.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230372 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230372 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230372">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230375" commentparentid="230372">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/KADR">
<img src="./Efficient and easy segment trees - Codeforces_files/9089397f80c0fe42.jpg">        </a>
        <div><a href="http://codeforces.com/profile/KADR" title="Grandmaster KADR" class="rated-user user-red">KADR</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 13:15 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230375" href="http://codeforces.com/blog/entry/18051?#comment-230375" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230372" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230375" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230375" data-commentrating="0" data-commentuserid="1028">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230375">
                    <div class="moveup">
                    <div class="ttypography"><p>I'm just saying that this way it's more similar to traditional segment tree implementation and thus easier to follow the logic. But you are right, it's just a matter of style :)</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230375 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230375 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230375">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table comment-bad" commentid="230330" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/innok96">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/innok96" title="Expert innok96" class="rated-user user-blue">innok96</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 07:52 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230330" href="http://codeforces.com/blog/entry/18051?#comment-230330" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230330" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230330" class="negative-comment-vote" data-commentrating="-16" data-commentuserid="209356">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">-16</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230330">
                    <div class="moveup">
                    <div class="ttypography"><p>it so useful for non-red participants</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230330 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230330 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230330">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="230409" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 15:43 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230409" href="http://codeforces.com/blog/entry/18051?#comment-230409" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230409" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="230409" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="230409" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230409">
                    <div class="moveup">
                    <div class="ttypography"><p>Hello, can you explain this line ? ~~~~~  t[p&gt;&gt;1] = t[p] + t[p^1] ~~~~~</p><p>Specifically, why are you xor-ing it?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230409 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230409 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230409">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230410" commentparentid="230409">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Rubanenko">
<img src="./Efficient and easy segment trees - Codeforces_files/1f1679364db3ac08.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Rubanenko" title="Candidate Master Rubanenko" class="rated-user user-violet">Rubanenko</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 15:48 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230410" href="http://codeforces.com/blog/entry/18051?#comment-230410" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230409" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230410" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230410" data-commentrating="6" data-commentuserid="2366">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+6</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230410">
                    <div class="moveup">
                    <div class="ttypography"><p>p&gt;&gt;1 is a parent of p in the tree. Another son of p&gt;&gt;1 is p^1, since x^1 gives you x with reversed parity(last bit). </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230410 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230410 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230410">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230412" commentparentid="230410">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 15:56 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230412" href="http://codeforces.com/blog/entry/18051?#comment-230412" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230410" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230412" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230412" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230412">
                    <div class="moveup">
                    <div class="ttypography"><p>So basically, p^1 equals p/2 + 1 ? </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230412 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230412 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230412">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230418" commentparentid="230412">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Rubanenko">
<img src="./Efficient and easy segment trees - Codeforces_files/1f1679364db3ac08.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Rubanenko" title="Candidate Master Rubanenko" class="rated-user user-violet">Rubanenko</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 16:19 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230418" href="http://codeforces.com/blog/entry/18051?#comment-230418" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230412" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230418" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230418" data-commentrating="18" data-commentuserid="2366">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+18</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230418">
                    <div class="moveup">
                    <div class="ttypography"><p>No, p^1 equals to p+1 if p is even, and p-1 if p is odd. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230418 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230418 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230418">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="230414" commentparentid="230409">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/mketa">
<img src="./Efficient and easy segment trees - Codeforces_files/437c7cf3c16ae468.jpg">        </a>
        <div><a href="http://codeforces.com/profile/mketa" title="Specialist mketa" class="rated-user user-cyan">mketa</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 16:07 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230414" href="http://codeforces.com/blog/entry/18051?#comment-230414" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230409" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230414" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230414" data-commentrating="1" data-commentuserid="217787">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+1</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230414">
                    <div class="moveup">
                    <div class="ttypography"><p>xor will give the other child of the parent. For example if p is left child, p^1 will give the right one. Quite an interesting way of doing this in fact.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230414 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230414 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230414">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230416" commentparentid="230414">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/27/2015 16:11 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230416" href="http://codeforces.com/blog/entry/18051?#comment-230416" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230414" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230416" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230416" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230416">
                    <div class="moveup">
                    <div class="ttypography"><p>Thank you!</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230416 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230416 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230416">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="230674" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/28/2015 13:38 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230674" href="http://codeforces.com/blog/entry/18051?#comment-230674" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230674" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230674" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230674">
                    <div class="moveup">
                    <div class="ttypography"><p>Hello, sorry to ask another silly question. Al.Cash says :</p><p>"l, the left interval border, is odd (which is equivalent to l&amp;1)”</p><p>I am not familiar with bit operations too much, and I am having difficulty how <code class="tt">x AND 1</code> gives odd/even value. Thanks in advance :)</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230674 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230674 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230674">
            <li>
<div class="comment">
    <table class="comment-table" commentid="230705" commentparentid="230674">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/edgarciarod">
<img src="./Efficient and easy segment trees - Codeforces_files/666f3e5663961350.jpg">        </a>
        <div><a href="http://codeforces.com/profile/edgarciarod" title="Expert edgarciarod" class="rated-user user-blue">edgarciarod</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/28/2015 18:03 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230705" href="http://codeforces.com/blog/entry/18051?#comment-230705" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230674" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230705" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230705" data-commentrating="3" data-commentuserid="121693">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+3</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230705">
                    <div class="moveup">
                    <div class="ttypography"><p>Every odd value ends with 1(3 = 11, 5 = 101) and every even value ends with 0(2 = 10, 4 = 100).</p> <pre><code class="prettyprint"><span class="pun">(</span><span class="pln">xxx1 </span><span class="kwd">and</span><span class="pln"> </span><span class="lit">0001</span><span class="pun">)</span><span class="pln"> </span><span class="pun">--&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="com">// odd</span><span class="pln">
</span><span class="pun">(</span><span class="pln">xxx0 </span><span class="kwd">and</span><span class="pln"> </span><span class="lit">0001</span><span class="pun">)</span><span class="pln"> </span><span class="pun">--&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="com">// even</span></code></pre></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230705 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230705 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230705">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table comment-bad" commentid="230710" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/alanor1">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/alanor1" title="Newbie alanor1" class="rated-user user-gray">alanor1</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/28/2015 18:27 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230710" href="http://codeforces.com/blog/entry/18051?#comment-230710" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230710" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230710" class="negative-comment-vote" data-commentrating="-13" data-commentuserid="286573">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">-13</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230710">
                    <div class="moveup">
                    <div class="ttypography"><p>Hi, I am new in competitive programming, I was reading this article and trying to use it , but i dont understand how the function query works, for example if I have these numbers 1 47 45 23 348 and I would like the sum from 47 to 23, whats numbers should I put in the arguments???? please help, thanks</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230710 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230710 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230710">
            <li>
<div class="comment">
    <table class="comment-table" commentid="269894" commentparentid="230710">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/sebinechita">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/sebinechita" title="Candidate Master sebinechita" class="rated-user user-violet">sebinechita</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/30/2015 18:31 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-269894" href="http://codeforces.com/blog/entry/18051?#comment-269894" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-230710" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="269894" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="269894" data-commentrating="0" data-commentuserid="135688">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-269894">
                    <div class="moveup">
                    <div class="ttypography"><p>well your array starts from position 0. Position of 47 is 1 and of 23 is 3. The Query will give you an answer for [l, r) so you should pass as arguments (1, 4). Hope it helps!</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-269894 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-269894 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-269894">
            <li>
<div class="comment">
    <table class="comment-table" commentid="269956" commentparentid="269894">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/alanor1">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/alanor1" title="Newbie alanor1" class="rated-user user-gray">alanor1</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/30/2015 23:29 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-269956" href="http://codeforces.com/blog/entry/18051?#comment-269956" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-269894" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="269956" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="269956" data-commentrating="0" data-commentuserid="286573">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-269956">
                    <div class="moveup">
                    <div class="ttypography"><p>thanks so much</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-269956 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-269956 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-269956">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="230864" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/29/2015 17:16 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230864" href="http://codeforces.com/blog/entry/18051?#comment-230864" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230864" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="230864" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="230864" data-commentrating="25" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+25</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230864">
                    <div class="moveup">
                    <div class="ttypography"><p>Section about lazy propagation has been added.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230864 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230864 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230864">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="230889" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/zscefn">
<img src="./Efficient and easy segment trees - Codeforces_files/2afaba626586210b.jpg">        </a>
        <div><a href="http://codeforces.com/profile/zscefn" title="Candidate Master zscefn" class="rated-user user-violet">zscefn</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/29/2015 20:01 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-230889" href="http://codeforces.com/blog/entry/18051?#comment-230889" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="230889" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="230889" data-commentrating="11" data-commentuserid="100053">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+11</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-230889">
                    <div class="moveup">
                    <div class="ttypography"><p>I did some speed comparison between recursive and non-recursive lazy segment trees. With array size of 1&lt;&lt;18 and 1e7 randomly chosen operations between modifications and queries. Array size of 1&lt;&lt;18 is of course easier for my recursive code which uses arrays of the size 2^n but on practise it doesn't affect much to the speed of the code. </p><p>My recursive ( <a href="http://paste.dy.fi/BUZ">http://paste.dy.fi/BUZ</a> ): 6 s</p><p>Non-recursive from the blog: ( <a href="http://paste.dy.fi/kBY">http://paste.dy.fi/kBY</a> ): 3 s</p><p>That's quite big difference in my opinion. Unfortunately the non-recursive one seems to be a bit more painful to code but maybe it's just that I'm used to code it recursively.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-230889 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-230889 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-230889">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="231203" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/zeura">
<img src="./Efficient and easy segment trees - Codeforces_files/b9650774063df1c7.jpg">        </a>
        <div><a href="http://codeforces.com/profile/zeura" title="Pupil zeura" class="rated-user user-green">zeura</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/30/2015 22:03 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-231203" href="http://codeforces.com/blog/entry/18051?#comment-231203" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="231203" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="231203" data-commentrating="0" data-commentuserid="265885">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-231203">
                    <div class="moveup">
                    <div class="ttypography"><p>I think your modification on all element in an interval is not incrementing every element in an interval.You should check it.<br>Ex: n=8 0 1 2 3 4 5 6 7 modif(0,8,5); It should increment all places by 5.According to your algorithm array t is-  33  6 22  1 5 9 13  0 1 2 3 4 5 6 7<br>but clearly all element isn't incremented by 5. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-231203 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-231203 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-231203">
            <li>
<div class="comment">
    <table class="comment-table" commentid="231271" commentparentid="231203">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/30/2015 23:58 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-231271" href="http://codeforces.com/blog/entry/18051?#comment-231271" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-231203" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="231271" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="231271" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-231271">
                    <div class="moveup">
                    <div class="ttypography"><p>Probably you're talking about the last example, but the operation there is assignment, not increment. And array looks absolutely correct except it should start with 40 not 33 (I believe 33 is a typo — let me know if it's not the case).</p><p>That's the point of 'lazy propagation' — not to modify anything until we really need it. You shouldn't access tree elements directly unless you called <em>push(0, 8)</em>.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-231271 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-231271 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-231271">
            <li>
<div class="comment">
    <table class="comment-table" commentid="231283" commentparentid="231271">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/zeura">
<img src="./Efficient and easy segment trees - Codeforces_files/b9650774063df1c7.jpg">        </a>
        <div><a href="http://codeforces.com/profile/zeura" title="Pupil zeura" class="rated-user user-green">zeura</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/31/2015 00:34 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-231283" href="http://codeforces.com/blog/entry/18051?#comment-231283" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-231271" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="231283" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="231283" data-commentrating="0" data-commentuserid="265885">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-231283">
                    <div class="moveup">
                    <div class="ttypography"><p>I was talking about this modify function: void modify(int l, int r, int value) {  for (l += n, r += n; l &lt; r; l &gt;&gt;= 1, r &gt;&gt;= 1) {  if (l&amp;1) t[l++] += value;  if (r&amp;1) t[--r] += value;  } }</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-231283 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-231283 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-231283">
            <li>
<div class="comment">
    <table class="comment-table" commentid="231287" commentparentid="231283">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/31/2015 00:55 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-231287" href="http://codeforces.com/blog/entry/18051?#comment-231287" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-231283" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="231287" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="231287" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-231287">
                    <div class="moveup">
                    <div class="ttypography"><p>I see. Again, if you want to get an element — call <em>query</em>, don't access the tree directly. And you don't need to call <em>build</em> in this example.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-231287 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-231287 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-231287">
            <li>
<div class="comment">
    <table class="comment-table" commentid="231305" commentparentid="231287">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/zeura">
<img src="./Efficient and easy segment trees - Codeforces_files/b9650774063df1c7.jpg">        </a>
        <div><a href="http://codeforces.com/profile/zeura" title="Pupil zeura" class="rated-user user-green">zeura</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="May/31/2015 01:11 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-231305" href="http://codeforces.com/blog/entry/18051?#comment-231305" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-231287" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="231305" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="231305" data-commentrating="0" data-commentuserid="265885">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-231305">
                    <div class="moveup">
                    <div class="ttypography"><p>Thanks, I think I got it. :D</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-231305 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-231305 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-231305">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="232728" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/siddharths067">
<img src="./Efficient and easy segment trees - Codeforces_files/894dbac825fa73dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/siddharths067" title="Newbie siddharths067" class="rated-user user-gray">siddharths067</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/05/2015 11:22 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-232728" href="http://codeforces.com/blog/entry/18051?#comment-232728" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="232728" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="232728" data-commentrating="0" data-commentuserid="259462">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-232728">
                    <div class="moveup">
                    <div class="ttypography"><p>Is it possible to extend this form to Multiple dimensions ! </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-232728 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-232728 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-232728">
            <li>
<div class="comment">
    <table class="comment-table" commentid="232916" commentparentid="232728">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/06/2015 01:47 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-232916" href="http://codeforces.com/blog/entry/18051?#comment-232916" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-232728" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="232916" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="232916" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-232916">
                    <div class="moveup">
                    <div class="ttypography"><p>Sure, just change one loop everywhere into two nested loops for different coordinates.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-232916 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-232916 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-232916">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="232956" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/wodesuck">
<img src="./Efficient and easy segment trees - Codeforces_files/233c675290f6e0a2.jpg">        </a>
        <div><a href="http://codeforces.com/profile/wodesuck" title="Expert wodesuck" class="rated-user user-blue">wodesuck</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/06/2015 08:51 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-232956" href="http://codeforces.com/blog/entry/18051?#comment-232956" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="232956" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="232956" data-commentrating="0" data-commentuserid="39627">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-232956">
                    <div class="moveup">
                    <div class="ttypography"><p>How to perform find-kth query? For n that is not the power of 2.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-232956 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-232956 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-232956">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="232961" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/satirmo">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/satirmo" title="Specialist satirmo" class="rated-user user-cyan">satirmo</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/06/2015 10:07 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-232961" href="http://codeforces.com/blog/entry/18051?#comment-232961" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="232961" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="232961" data-commentrating="0" data-commentuserid="240648">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-232961">
                    <div class="moveup">
                    <div class="ttypography"><p>Hi. I have a question. When should it be considered necessary to use lazy propagation?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-232961 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-232961 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-232961">
            <li>
<div class="comment">
    <table class="comment-table" commentid="232991" commentparentid="232961">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/06/2015 13:35 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-232991" href="http://codeforces.com/blog/entry/18051?#comment-232991" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-232961" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="232991" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="232991" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-232991">
                    <div class="moveup">
                    <div class="ttypography"><p>When you have both range modifications and range queries, or just range modifications for which order is important (for example, assignment).</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-232991 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-232991 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-232991">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="233791" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/siddharths067">
<img src="./Efficient and easy segment trees - Codeforces_files/894dbac825fa73dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/siddharths067" title="Newbie siddharths067" class="rated-user user-gray">siddharths067</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/08/2015 06:41 UTC+5.5">10 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-233791" href="http://codeforces.com/blog/entry/18051?#comment-233791" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="233791" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="233791" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="233791" data-commentrating="0" data-commentuserid="259462">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-233791">
                    <div class="moveup">
                    <div class="ttypography"><p>Is it possible to generalize the structure for the Lazy propagation Loop , as in both the cases the propagation format of the loop changes. In recursion , no matter what the context the function has the same structure for lazy propagation namely , checking the Boolean flag and changing the value of the child nodes..</p><p>It would be better if you generalize it ....</p><p><strong>For Example in Function Build :</strong></p> <pre><code class="prettyprint"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> s </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">s</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> l </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> r </span><span class="pun">&gt;&gt;</span><span class="pln"> s</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></code></pre><p>From Sum Queries</p> <pre><code class="prettyprint"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span></code></pre><p>To RMQ</p><p>There is a difference in initial values of l and r in each loop.</p><p>Note: My Concern here is generalizing a loop for propagating the Segment Tree Lazily , I don't Care about the additional factor K for Sum queries or any additional parameter for a particular purpose.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-233791 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-233791 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-233791">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="238800" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/ACMath">
<img src="./Efficient and easy segment trees - Codeforces_files/705ba07f796cabd.jpg">        </a>
        <div><a href="http://codeforces.com/profile/ACMath" title="Expert ACMath" class="rated-user user-blue">ACMath</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jun/28/2015 20:41 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-238800" href="http://codeforces.com/blog/entry/18051?#comment-238800" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="238800" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="238800" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="238800" data-commentrating="0" data-commentuserid="149990">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-238800">
                    <div class="moveup">
                    <div class="ttypography"><p>Understood. + for you!</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-238800 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-238800 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-238800">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240006" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/praveen14078">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/praveen14078" title="Pupil praveen14078" class="rated-user user-green">praveen14078</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 01:37 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240006" href="http://codeforces.com/blog/entry/18051?#comment-240006" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240006" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240006" data-commentrating="0" data-commentuserid="293417">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240006">
                    <div class="moveup">
                    <div class="ttypography"><p>Can anyone please explain how the code in section "Modification on interval, single element access" actually work with a small example if possiple explaining how to we get sum over a range after the update(which also I am not able to understand!) ?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240006 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240006 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240006">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240058" commentparentid="240006">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 19:11 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240058" href="http://codeforces.com/blog/entry/18051?#comment-240058" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240006" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240058" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240058" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240058">
                    <div class="moveup">
                    <div class="ttypography"><p>This example doesn't support getting sum over a range, only single element access (I was hoping it's clear from the heading). It only shows that sometimes we can invert basic operations, but for more complex operations you need lazy propagation.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240058 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240058 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240058">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240059" commentparentid="240058">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/praveen14078">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/praveen14078" title="Pupil praveen14078" class="rated-user user-green">praveen14078</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 19:16 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240059" href="http://codeforces.com/blog/entry/18051?#comment-240059" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240058" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240059" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240059" data-commentrating="0" data-commentuserid="293417">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240059">
                    <div class="moveup">
                    <div class="ttypography"><p>can you give an example of single element access after some update , i am not able to grasp how query() would return a[p] (as u mentioned in some earlier comment to call query to access an element or simply what does the query() do ?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240059 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240059 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240059">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240082" commentparentid="240059">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 23:13 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240082" href="http://codeforces.com/blog/entry/18051?#comment-240082" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240059" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240082" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240082" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240082">
                    <div class="moveup">
                    <div class="ttypography"><p>query() doesn't simply access the element — it calculates it as a sum of all the updates applied to that element.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240082 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240082 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240082">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240044" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/nishanthvydana">
<img src="./Efficient and easy segment trees - Codeforces_files/d60941f4c36aa0a9.jpg">        </a>
        <div><a href="http://codeforces.com/profile/nishanthvydana" title="Specialist nishanthvydana" class="rated-user user-cyan">nishanthvydana</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 17:12 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240044" href="http://codeforces.com/blog/entry/18051?#comment-240044" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240044" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="240044" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="240044" data-commentrating="0" data-commentuserid="221812">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240044">
                    <div class="moveup">
                    <div class="ttypography"><p>Can someone explain logic(bit operations) here (t[p += n] = value; p &gt; 1; p &gt;&gt;= 1)</p><p>The above expression is from the below function void modify(int p, int value) { // set value at position p  for (t[p += n] = value; p &gt; 1; p &gt;&gt;= 1) t[p&gt;&gt;1] = t[p] + t[p^1]; }</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240044 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240044 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240044">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240051" commentparentid="240044">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 18:09 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240051" href="http://codeforces.com/blog/entry/18051?#comment-240051" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240044" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240051" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240051" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240051">
                    <div class="moveup">
                    <div class="ttypography"><p>It is equivalent to this simplified code:</p> <pre><code class="prettyprint"><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> new_val</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">{</span><span class="pln">
		p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
		tree</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> new_val</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(;</span><span class="pln"> p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> p</span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">{</span><span class="pln">
			tree</span><span class="pun">[</span><span class="pln">p</span><span class="pun">/</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tree</span><span class="pun">[</span><span class="pln">p</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> tree</span><span class="pun">[</span><span class="pln">p</span><span class="pun">^</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span></code></pre><p>For the explanation of using xor(^) you can check the previous comment that I made.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240051 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240051 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240051">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240130" commentparentid="240051">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/nishanthvydana">
<img src="./Efficient and easy segment trees - Codeforces_files/d60941f4c36aa0a9.jpg">        </a>
        <div><a href="http://codeforces.com/profile/nishanthvydana" title="Specialist nishanthvydana" class="rated-user user-cyan">nishanthvydana</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/07/2015 11:51 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240130" href="http://codeforces.com/blog/entry/18051?#comment-240130" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240051" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240130" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240130" data-commentrating="0" data-commentuserid="221812">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240130">
                    <div class="moveup">
                    <div class="ttypography"><p>Can u explain query function a bit more clearly Thanks for ur previous answer</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240130 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240130 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240130">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240049" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Pro">
<img src="./Efficient and easy segment trees - Codeforces_files/1709cf7f9babf5dc.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Pro" title="Pupil I_love_Pro" class="rated-user user-green">I_love_Pro</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 17:58 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240049" href="http://codeforces.com/blog/entry/18051?#comment-240049" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240049" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240049" data-commentrating="0" data-commentuserid="298584">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240049">
                    <div class="moveup">
                    <div class="ttypography"><p>Thanks for this post, it is very useful for beginners like me. But there is a small problem; the picture of the segment tree at the very beginning of the post is not showing. It would be nice if you fixed that :) </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240049 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240049 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240049">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240062" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/wadhwasahil">
<img src="./Efficient and easy segment trees - Codeforces_files/1bbfd5c11fa5242.jpg">        </a>
        <div><a href="http://codeforces.com/profile/wadhwasahil" title="Specialist wadhwasahil" class="rated-user user-cyan">wadhwasahil</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 19:30 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240062" href="http://codeforces.com/blog/entry/18051?#comment-240062" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240062" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="240062" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="240062" data-commentrating="0" data-commentuserid="145500">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240062">
                    <div class="moveup">
                    <div class="ttypography"><p>Please can somebody explain how to change all the elements of an array in an interval [l,r]to a constant value v using lazy propagation.</p><p>Thanks.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240062 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240062 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240062">
            <li>
<div class="comment">
    <table class="comment-table" commentid="240083" commentparentid="240062">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/06/2015 23:18 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240083" href="http://codeforces.com/blog/entry/18051?#comment-240083" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240062" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240083" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240083" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240083">
                    <div class="moveup">
                    <div class="ttypography"><p>The last example does exactly that, assignment on an interval.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240083 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240083 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240083">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240139" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/sierra101">
<img src="./Efficient and easy segment trees - Codeforces_files/f4a059661f327315.jpg">        </a>
        <div><a href="http://codeforces.com/profile/sierra101" title="Specialist sierra101" class="rated-user user-cyan">sierra101</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/07/2015 14:24 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240139" href="http://codeforces.com/blog/entry/18051?#comment-240139" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240139" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="240139" data-commentrating="0" data-commentuserid="223651">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240139">
                    <div class="moveup">
                    <div class="ttypography"><p>how to scale values in a given range say [L,R] with constant C by segment tree or BIT . Thanks in advance :D</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240139 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240139 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240139">
            <li>
<div class="comment">
    <table class="comment-table" commentid="243216" commentparentid="240139">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/I_love_Meta_MZ">
<img src="./Efficient and easy segment trees - Codeforces_files/27bb5358e6acaee3.jpg">        </a>
        <div><a href="http://codeforces.com/profile/I_love_Meta_MZ" title="Specialist I_love_Meta_MZ" class="rated-user user-cyan">I_love_Meta_MZ</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/30/2015 21:19 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-243216" href="http://codeforces.com/blog/entry/18051?#comment-243216" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-240139" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="243216" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="243216" data-commentrating="0" data-commentuserid="103639">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-243216">
                    <div class="moveup">
                    <div class="ttypography"><p>I dont know for BIT but for segtree you can store additional <code class="tt">factor</code> for all nodes (initialized by 1). For each scale query, just scale this factor properties as always.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-243216 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-243216 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-243216">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="240193" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/SuryanshT">
<img src="./Efficient and easy segment trees - Codeforces_files/1d900b6ef37b2dfb.jpg">        </a>
        <div><a href="http://codeforces.com/profile/SuryanshT" title="Specialist SuryanshT" class="rated-user user-cyan">SuryanshT</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jul/07/2015 23:25 UTC+5.5">9 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-240193" href="http://codeforces.com/blog/entry/18051?#comment-240193" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="240193" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="240193" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="240193" data-commentrating="0" data-commentuserid="298943">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-240193">
                    <div class="moveup">
                    <div class="ttypography"><p>i didn't get this part -</p> <pre><code class="prettyprint"><span class="typ">When</span><span class="pln"> processing the left border</span><span class="pun">,</span><span class="pln"> the node we modify </span><span class="kwd">is</span><span class="pln"> always the right child of its parent</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Then</span><span class="pln"> all the previous modifications were made </span><span class="kwd">in</span><span class="pln"> the subtree of the left child of the same parent</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Otherwise</span><span class="pln"> we would process the parent instead of both its children</span><span class="pun">.</span><span class="pln"> </span><span class="typ">This</span><span class="pln"> means current direct parent </span><span class="kwd">is</span><span class="pln"> also a parent of leaf l</span><span class="pun">+</span><span class="pln">n</span></code></pre></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-240193 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-240193 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-240193">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="243608" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/abinash_nitr">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/abinash_nitr" title="Unrated, abinash_nitr" class="rated-user user-black">abinash_nitr</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/02/2015 11:46 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-243608" href="http://codeforces.com/blog/entry/18051?#comment-243608" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="243608" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="243608" data-commentrating="0" data-commentuserid="308857">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-243608">
                    <div class="moveup">
                    <div class="ttypography"><p>I am new to segment tree and algorithms in general. I see a difference in implementation of query function at <a href="http://codeforces.com/blog/entry/1256">http://codeforces.com/blog/entry/1256</a>. In my observation query function in this post does not give correct result. Did anyone else notice that? </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-243608 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-243608 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-243608">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="245596" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/ErdemKirez">
<img src="./Efficient and easy segment trees - Codeforces_files/a357ba2248beaf78.jpg">        </a>
        <div><a href="http://codeforces.com/profile/ErdemKirez" title="Candidate Master ErdemKirez" class="rated-user user-violet">ErdemKirez</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/12/2015 22:53 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-245596" href="http://codeforces.com/blog/entry/18051?#comment-245596" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="245596" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="245596" data-commentrating="5" data-commentuserid="87308">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+5</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-245596">
                    <div class="moveup">
                    <div class="ttypography"><p>I have a little question. In this problem, <a href="http://codeforces.com/problemset/problem/533/A">533A — Berland Miners</a>, I used this. I used this before, so I thought it works perfectly. </p><p>My submission with <span class="tex-span"><i>N</i> = 10<sup class="upper-index">6</sup> + 5</span> got WA. When I changed it to <span class="tex-span"><i>N</i> = 2<sup class="upper-index">20</sup></span>, it took AC.</p><p><span class="tex-span"><i>N</i> = 10<sup class="upper-index">6</sup> + 5</span> --&gt; <a href="http://codeforces.com/contest/533/submission/12482628">http://codeforces.com/contest/533/submission/12482628</a></p><p><span class="tex-span"><i>N</i> = 2<sup class="upper-index">20</sup></span> --&gt; <a href="http://codeforces.com/contest/533/submission/12483080">http://codeforces.com/contest/533/submission/12483080</a></p><p><span class="tex-span">2<sup class="upper-index">20</sup></span> is bigger than <span class="tex-span">10<sup class="upper-index">6</sup> + 5</span> but problem isn't this. I tried it with <span class="tex-span"><i>N</i> = 2 * 10<sup class="upper-index">6</sup> + 5</span> but I got WA again.</p><p><span class="tex-span"><i>N</i> = 2 * 10<sup class="upper-index">6</sup> + 5</span> --&gt; <a href="http://codeforces.com/contest/533/submission/12483105">http://codeforces.com/contest/533/submission/12483105</a></p><p>Do you have any idea about it?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-245596 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-245596 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-245596">
            <li>
<div class="comment">
    <table class="comment-table" commentid="245622" commentparentid="245596">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Urbanowicz">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Urbanowicz" title="Expert Urbanowicz" class="rated-user user-blue">Urbanowicz</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/13/2015 02:46 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-245622" href="http://codeforces.com/blog/entry/18051?#comment-245622" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-245596" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="245622" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="245622" data-commentrating="5" data-commentuserid="11366">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+5</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-245622">
                    <div class="moveup">
                    <div class="ttypography"><p>As said in this post:</p> <blockquote><p>It's not actually a single tree any more, but a set of perfect binary trees</p> </blockquote><p>Not sure, where exactly that fails for you, but I guess it's here:</p> <pre><code class="prettyprint"><span class="kwd">int</span><span class="pln"> mn </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">op</span><span class="pun">[</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> x</span><span class="pun">],</span><span class="pln"> cl</span><span class="pun">[</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]);</span></code></pre><p>Seems like you intend to take left child of <code class="tt">op</code> and right child of <code class="tt">cl</code>, but when you have a set of trees it doesn't always work.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-245622 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-245622 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-245622">
            <li>
<div class="comment">
    <table class="comment-table" commentid="245629" commentparentid="245622">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/ErdemKirez">
<img src="./Efficient and easy segment trees - Codeforces_files/a357ba2248beaf78.jpg">        </a>
        <div><a href="http://codeforces.com/profile/ErdemKirez" title="Candidate Master ErdemKirez" class="rated-user user-violet">ErdemKirez</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/13/2015 03:14 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-245629" href="http://codeforces.com/blog/entry/18051?#comment-245629" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-245622" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="245629" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="245629" data-commentrating="5" data-commentuserid="87308">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+5</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-245629">
                    <div class="moveup">
                    <div class="ttypography"><p>I didn't understand the problem on here. Is it different from maximum of range or another segment operation?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-245629 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-245629 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-245629">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="245623" commentparentid="245596">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Urbanowicz">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Urbanowicz" title="Expert Urbanowicz" class="rated-user user-blue">Urbanowicz</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/13/2015 02:52 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-245623" href="http://codeforces.com/blog/entry/18051?#comment-245623" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-245596" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="245623" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="245623" data-commentrating="5" data-commentuserid="11366">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+5</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-245623">
                    <div class="moveup">
                    <div class="ttypography"><p>But it works with <span class="tex-span"><i>N</i> = 3·10<sup class="upper-index">6</sup> + 5</span>... <a href="http://codeforces.com/contest/533/submission/12484538" title="Submission 12484538 by Urbanowicz">12484538</a></p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-245623 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-245623 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-245623">
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table" commentid="245659" commentparentid="245596">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Aug/13/2015 12:07 UTC+5.5">8 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-245659" href="http://codeforces.com/blog/entry/18051?#comment-245659" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-245596" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="245659" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="245659" data-commentrating="5" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+5</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-245659">
                    <div class="moveup">
                    <div class="ttypography"><p>I think the problem is in this line: <code class="tt">if(op[1] == 0)</code></p><p>Node 1 is a true root only if N is a power of 2, otherwise it's not trivial to define what's stored there (just look at the picture).</p><p>Everything is guaranteed to work only if you use queries and don't access tree element directly (except for leaves).</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-245659 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-245659 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-245659">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="255156" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/dadax85">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/dadax85" title="Specialist dadax85" class="rated-user user-cyan">dadax85</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Oct/07/2015 16:23 UTC+5.5">6 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-255156" href="http://codeforces.com/blog/entry/18051?#comment-255156" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="255156" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="255156" data-commentrating="10" data-commentuserid="285623">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+10</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-255156">
                    <div class="moveup">
                    <div class="ttypography"><p>Great and efficient implementation. Could you please say more about "Modification on interval [l, r) affects t[i] values only in the parents of border leaves: l+n and r+n-1.". Because, the inc method modifies more than the parents of the border leaves.</p><p>If I well understood, you want to explain the fact that in query method (max implementation) we need only to push down ONLY to the left border and right border nodes. Since when computing the query we will be using only the nodes along the route. Moreover, this explains the fact that when we finish increment method, we need ONLY to propagate up to to root of the tree starting from the left and right border leaves, so that the tree and the lazy array will be consistent and representing correct values. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-255156 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-255156 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-255156">
            <li>
<div class="comment">
    <table class="comment-table" commentid="255273" commentparentid="255156">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Oct/08/2015 00:41 UTC+5.5">6 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-255273" href="http://codeforces.com/blog/entry/18051?#comment-255273" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-255156" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="255273" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="255273" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-255273">
                    <div class="moveup">
                    <div class="ttypography"><p>You're right. I wanted to say what values are affected except the ones we modify directly in the loop (the ones that compose the interval). Will think how to formulate it better.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-255273 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-255273 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-255273">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="258073" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/rvelloso">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/rvelloso" title="Unrated, rvelloso" class="rated-user user-black">rvelloso</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Oct/23/2015 01:29 UTC+5.5">6 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-258073" href="http://codeforces.com/blog/entry/18051?#comment-258073" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="258073" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="258073" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="258073" data-commentrating="0" data-commentuserid="347435">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-258073">
                    <div class="moveup">
                    <div class="ttypography"><pre><code class="prettyprint"><span class="com">// In case someone needs: query with [l, r] inclusive interval:</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// sum on interval [l, r]</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++];</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">))</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">r</span><span class="pun">--];</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-258073 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-258073 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-258073">
            <li>
<div class="comment">
    <table class="comment-table" commentid="258191" commentparentid="258073">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Oct/24/2015 13:16 UTC+5.5">5 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-258191" href="http://codeforces.com/blog/entry/18051?#comment-258191" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-258073" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="258191" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="258191" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="258191" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-258191">
                    <div class="moveup">
                    <div class="ttypography"><p>If you prefer closed interval, just change <code class="tt">r += n</code> to <code class="tt">r += n+1</code>, otherwise it's easy to make mistakes.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-258191 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-258191 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-258191">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="263737" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/ReaLNero">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/ReaLNero" title="Expert ReaLNero" class="rated-user user-blue">ReaLNero</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Nov/21/2015 02:45 UTC+5.5">5 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-263737" href="http://codeforces.com/blog/entry/18051?#comment-263737" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="263737" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="263737" data-commentrating="0" data-commentuserid="290793">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-263737">
                    <div class="moveup">
                    <div class="ttypography"><p>You said that range modifications and point updates are simple, but the following test case doesn't give a correct example (if I understood the problem correctly): - 5 nodes - 1 2 4 8 16 are t[n, n + 1, n + 2, n + 3, n + 4] - one modification: add 2 to [0, 5) - query for 0</p><p>returns 59, while it should be 3.</p><p>Code (same as all the functions given above, but for unambiguity:</p> <pre><code class="prettyprint"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cstdio&gt;</span><span class="pln">

</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> N </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e5</span><span class="pun">;</span><span class="pln">  </span><span class="com">// limit for array size</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">  </span><span class="com">// array size</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">[</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> N</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> build</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// build the tree</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> modify</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> t</span><span class="pun">[--</span><span class="pln">r</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> p </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> res </span><span class="pun">+=</span><span class="pln"> t</span><span class="pun">[</span><span class="pln">p</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  scanf</span><span class="pun">(</span><span class="str">"%d"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> scanf</span><span class="pun">(</span><span class="str">"%d"</span><span class="pun">,</span><span class="pln"> t </span><span class="pun">+</span><span class="pln"> n </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">);</span><span class="pln">
  build</span><span class="pun">();</span><span class="pln">
  modify</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">
  printf</span><span class="pun">(</span><span class="str">"%d\n"</span><span class="pun">,</span><span class="pln"> query</span><span class="pun">(</span><span class="lit">0</span><span class="pun">));</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Input: 5 1 2 4 8 16</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-263737 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-263737 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-263737">
            <li>
<div class="comment">
    <table class="comment-table" commentid="263740" commentparentid="263737">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Nov/21/2015 03:11 UTC+5.5">5 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-263740" href="http://codeforces.com/blog/entry/18051?#comment-263740" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-263737" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="263740" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="263740" data-commentrating="0" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-263740">
                    <div class="moveup">
                    <div class="ttypography"><p>Just remove build — it doesn't belong to this example.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-263740 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-263740 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-263740">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="263864" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/1theweblover007">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/1theweblover007" title="Pupil 1theweblover007" class="rated-user user-green">1theweblover007</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Nov/21/2015 22:28 UTC+5.5">5 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-263864" href="http://codeforces.com/blog/entry/18051?#comment-263864" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="263864" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="263864" data-commentrating="0" data-commentuserid="299666">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-263864">
                    <div class="moveup">
                    <div class="ttypography"><p><a class="rated-user user-red" href="http://codeforces.com/profile/Al.Cash" title="Grandmaster Al.Cash">Al.Cash</a> , I am finding the code inside the header of for-loop too confusing, Can you please tell me the easy and the common version of theirs ?</p><p>Like this :</p> <pre><code class="prettyprint"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span></code></pre><p>What does it mean ? Its tough for me to understand. Would be great if you could clarify this. </p><p>Thanks Alot. PS. Nice work on the tutorial, CF needs more articles like this one :)</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-263864 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-263864 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-263864">
            <li>
<div class="comment">
    <table class="comment-table" commentid="265449" commentparentid="263864">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/yeputons">
<img src="./Efficient and easy segment trees - Codeforces_files/cfc26825136c163e.jpg">        </a>
        <div><a href="http://codeforces.com/profile/yeputons" title="International Grandmaster yeputons" class="rated-user user-red">yeputons</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/01/2015 00:34 UTC+5.5">4 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-265449" href="http://codeforces.com/blog/entry/18051?#comment-265449" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-263864" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="265449" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="265449" data-commentrating="8" data-commentuserid="2412">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+8</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-265449">
                    <div class="moveup">
                    <div class="ttypography"><p>Step-by-step, in the simpler case (when <span class="tex-span"><i>n</i> = 2<sup class="upper-index"><i>k</i></sup></span> and we have full binary tree). Consider <span class="tex-span"><i>n</i> = 16</span>:</p> <ol>   <li>We have both <code class="tt">l</code> and <code class="tt">r</code> from <span class="tex-span">[0, 16]</span>, as outer world does not know anything about tree representation — it gives is bounds of the query.</li>   <li>First operation of <code class="tt">for</code> is executed exactly once before any iteration (as per definition). That is: add <span class="tex-span"><i>n</i></span> (16 in our case) to both <code class="tt">l</code> and <code class="tt">r</code>, i.e. convert "array coordinates" to numbers of vertices in the tree.</li>   <li>Then we iterate while current segment is not-empty, that is <span class="tex-span"><i>l</i> &lt; <i>r</i></span>.</li>   <li>After each iteration we move 'up' the tree. We know that parent of vertex <span class="tex-span"><i>x</i></span> is <img align="middle" class="tex-formula" src="./Efficient and easy segment trees - Codeforces_files/16df721c371994e27365ba333c6f908fb29bf0aa.png" style="max-width: 100.0%;max-height: 100.0%;">, so we should divide both <code class="tt">l</code> and <code class="tt">r</code> by two. <code class="tt">&gt;&gt;= 1</code> means "bitwise shift by one bit", which works exactly like division by two with rounding down for non-negative integers.</li> </ol></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-265449 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-265449 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-265449">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="265445" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/saurabh.kakar05">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/saurabh.kakar05" title="Newbie saurabh.kakar05" class="rated-user user-gray">saurabh.kakar05</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/01/2015 00:19 UTC+5.5">4 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-265445" href="http://codeforces.com/blog/entry/18051?#comment-265445" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="265445" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="265445" revisioncount="3" revision="3">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">3</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="265445" data-commentrating="0" data-commentuserid="99874">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-265445">
                    <div class="moveup">
                    <div class="ttypography"><p>Hi, I am trying to solve SPOJ GSS1 according to this tutorial on Segement Trees. But I am not able to write a query method. Following is my code so far. I understood the logic but not able to write query method. Please help.</p> <pre><code class="prettyprint"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Scanner</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> GSS1_CanYouAnswerTheseQueriesI </span><span class="pun">{</span><span class="pln">


	</span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> left</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> right</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> segsum</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> bestsum</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">super</span><span class="pun">();</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">left </span><span class="pun">=</span><span class="pln"> left</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">right </span><span class="pun">=</span><span class="pln"> right</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">segsum </span><span class="pun">=</span><span class="pln"> segsum</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">bestsum </span><span class="pun">=</span><span class="pln"> bestsum</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">(){</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">left </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">MIN_VALUE</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">right </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">MIN_VALUE</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">segsum </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">MIN_VALUE</span><span class="pun">;</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">bestsum </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">MIN_VALUE</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> left</span><span class="pun">,</span><span class="pln">right</span><span class="pun">,</span><span class="pln">segsum</span><span class="pun">,</span><span class="pln">bestsum</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">};</span><span class="pln">

	</span><span class="com">//array size</span><span class="pln">
	</span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">static</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">[]</span><span class="pln"> nodes</span><span class="pun">;</span><span class="pln">
	
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		  </span><span class="typ">Scanner</span><span class="pln"> sc </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Scanner</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">in</span><span class="pun">);</span><span class="pln">	
		  n </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">();</span><span class="pln">
		  </span><span class="com">//Height of segment tree </span><span class="pln">
	      </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">ceil</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)));</span><span class="pln">
	      </span><span class="com">//Maximum size of segment tree</span><span class="pln">
	      </span><span class="kwd">int</span><span class="pln"> max_size </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">pow</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
	      nodes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">[</span><span class="pln">max_size</span><span class="pun">];</span><span class="pln">
	      
		  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">){</span><span class="pln">
			  </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">();</span><span class="pln">
			  </span><span class="typ">SegNode</span><span class="pln"> node </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">(</span><span class="kwd">in</span><span class="pun">,</span><span class="kwd">in</span><span class="pun">,</span><span class="kwd">in</span><span class="pun">,</span><span class="kwd">in</span><span class="pun">);</span><span class="pln">
			  </span><span class="com">//nodes[n + i - 1] = node;</span><span class="pln">
			  nodes</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> node</span><span class="pun">;</span><span class="pln">
		  </span><span class="pun">}</span><span class="pln"> 
			   
		  
		  build</span><span class="pun">();</span><span class="pln">
		  </span><span class="kwd">int</span><span class="pln"> M </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">();</span><span class="pln">
		 
		  </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="pln">M</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
			  </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">();</span><span class="pln">
			  </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> sc</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">();</span><span class="pln">
			  </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">query</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln">r</span><span class="pun">));</span><span class="pln">
		  </span><span class="pun">}</span><span class="pln">
		  
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pln"> merge</span><span class="pun">(</span><span class="typ">SegNode</span><span class="pln"> cl</span><span class="pun">,</span><span class="typ">SegNode</span><span class="pln"> cr</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">{</span><span class="pln">
		</span><span class="typ">SegNode</span><span class="pln"> newNode </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">();</span><span class="pln"> 
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cl</span><span class="pun">!=</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> cr</span><span class="pun">!=</span><span class="kwd">null</span><span class="pun">){</span><span class="pln">
			newNode</span><span class="pun">.</span><span class="pln">segsum </span><span class="pun">=</span><span class="pln"> cl</span><span class="pun">.</span><span class="pln">segsum</span><span class="pun">+</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">segsum</span><span class="pun">;</span><span class="pln">
			newNode</span><span class="pun">.</span><span class="pln">left </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="pln">cl</span><span class="pun">.</span><span class="pln">segsum</span><span class="pun">+</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">left</span><span class="pun">,</span><span class="pln">cl</span><span class="pun">.</span><span class="pln">left</span><span class="pun">);</span><span class="pln">
			newNode</span><span class="pun">.</span><span class="pln">right </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">segsum</span><span class="pun">+</span><span class="pln">cl</span><span class="pun">.</span><span class="pln">right</span><span class="pun">,</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">right</span><span class="pun">);</span><span class="pln">
			newNode</span><span class="pun">.</span><span class="pln">bestsum </span><span class="pun">=</span><span class="pln"> max3</span><span class="pun">(</span><span class="pln">cl</span><span class="pun">.</span><span class="pln">bestsum</span><span class="pun">,</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">bestsum</span><span class="pun">,</span><span class="pln">cl</span><span class="pun">.</span><span class="pln">right</span><span class="pun">+</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">left</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> newNode</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cl</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> cr</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">){</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> cl</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		
		</span><span class="kwd">return</span><span class="pln"> newNode</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> max3</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">,</span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln">b</span><span class="pun">),</span><span class="pln">c</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> build</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// build the tree</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln">i</span><span class="pun">){</span><span class="pln"> 
			nodes</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SegNode</span><span class="pun">();</span><span class="pln">
			nodes</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">],</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">i</span><span class="pun">&lt;&lt;</span><span class="lit">1</span><span class="pun">|</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">
			</span><span class="com">//nodes[i] = merge(nodes[2*i+1],nodes[2*i+2]);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> query</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">// sum on interval (l, r)</span><span class="pln">
		</span><span class="typ">SegNode</span><span class="pln"> leftinMergeNode </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="typ">SegNode</span><span class="pln"> rightinMerge </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">

		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">+=</span><span class="pln"> n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&lt;=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln"> l </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="com">//if l is the right child</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">l</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)&gt;</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				leftinMergeNode </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">leftinMergeNode</span><span class="pun">,</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">l</span><span class="pun">++]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			</span><span class="com">//if r is the left child</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">r</span><span class="pun">&amp;</span><span class="lit">1</span><span class="pun">)==</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				rightinMerge </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">rightinMerge</span><span class="pun">,</span><span class="pln">nodes</span><span class="pun">[</span><span class="pln">r</span><span class="pun">--]);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			
	</span><span class="pun">}</span><span class="pln">

		</span><span class="typ">SegNode</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">(</span><span class="pln">leftinMergeNode</span><span class="pun">,</span><span class="pln">rightinMerge</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">.</span><span class="pln">bestsum</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">	
</span></code></pre></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-265445 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-265445 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-265445">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="265503" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/LaFuckinGioconda">
<img src="./Efficient and easy segment trees - Codeforces_files/b2d7cbbf574e59d2.jpg">        </a>
        <div><a href="http://codeforces.com/profile/LaFuckinGioconda" title="Pupil LaFuckinGioconda" class="rated-user user-green">LaFuckinGioconda</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/01/2015 10:02 UTC+5.5">4 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-265503" href="http://codeforces.com/blog/entry/18051?#comment-265503" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="265503" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="265503" data-commentrating="0" data-commentuserid="340095">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-265503">
                    <div class="moveup">
                    <div class="ttypography"><p>What a nice! I'm fucking wet.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-265503 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-265503 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-265503">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="267388" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/punetharomil">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/punetharomil" title="Unrated, punetharomil" class="rated-user user-black">punetharomil</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/15/2015 08:08 UTC+5.5">4 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-267388" href="http://codeforces.com/blog/entry/18051?#comment-267388" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="267388" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="267388" data-commentrating="0" data-commentuserid="364408">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-267388">
                    <div class="moveup">
                    <div class="ttypography"><p>5 elements. (Read as 'count of 0 is 5') 0-&gt;5 1-&gt;0 2-&gt;0 3-&gt;0 4-&gt;0. Therefore for query &lt;1, the answer should be 4 cuz 4 slots have value &lt;1 (1,2,3 and 4).</p><p>according to this implementation when array is not of size 2^n, the tree is coming out to be wrong. n=5. so we start filling at n=5.</p><p>We have 4 slots with value [0,1) and 1 slot with value [5-6). The array would be like:  (started filling at 5 cuz n=5, representing [0,1)) 0 1 2 3 4 5 6 7 8 9 10<br>0 0 0 0 0 4 0 0 0 0 1</p><p>now when making segment for array index 10, the value at index 5 gets overwritten. How to handle this?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-267388 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-267388 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-267388">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="269883" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/eggeek">
<img src="./Efficient and easy segment trees - Codeforces_files/bae8799f9a73fa9d.jpg">        </a>
        <div><a href="http://codeforces.com/profile/eggeek" title="Specialist eggeek" class="rated-user user-cyan">eggeek</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/30/2015 17:17 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-269883" href="http://codeforces.com/blog/entry/18051?#comment-269883" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="269883" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="269883" data-commentrating="0" data-commentuserid="32411">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-269883">
                    <div class="moveup">
                    <div class="ttypography"><p>To this line </p> <pre><code class="prettyprint"><span class="typ">Modification</span><span class="pln"> on interval </span><span class="pun">[</span><span class="pln">l</span><span class="pun">, </span><span class="pln">r</span><span class="pun">)</span><span class="pln"> affects t</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> values only </span><span class="kwd">in</span><span class="pln"> the parents of border leaves</span><span class="pun">:</span><span class="pln"> l</span><span class="pun">+</span><span class="pln">n </span><span class="kwd">and</span><span class="pln"> r</span><span class="pun">+</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">except</span><span class="pln"> the values that compose the interval itself </span><span class="pun">—</span><span class="pln"> the ones accessed </span><span class="kwd">in</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> loop</span><span class="pun">).</span></code></pre><p>I have a question:  If the <strong>apply</strong> operation does not satisfy the associative law, is it still work?</p><p>For example:  <code class="tt">modify(3, 11, value1)</code></p><p>1 If I use <strong>push(3, 11)</strong>, operations on node 5 is:</p><p>1.1 apply(2, d[2]); ( in the <code class="tt">push</code> loop); </p><p>1.2 d[5] += d[2] ( in the <code class="tt">apply</code>);</p><p>1.3 d[2] is passed to 5's son, d[5] = 0 (in the <code class="tt">apply(5, d[5])</code>;</p><p>1.4 d[5] = value (in the <code class="tt">modify</code> loop);</p><p>...</p><p>value is passed to 5's son 10 and 11, so:</p><p>1.5 <strong>d[10] = (d[10] + d[2]) + value;</strong> ( same to 11) </p><p>2 If I use <strong>push(3, 4), push(10, 11)</strong>, operations on node 5 is:</p><p>2.1 apply(2, d[2]); (in the <code class="tt">push</code> loop);</p><p>2.2 d[5] += d[2]; (in the <code class="tt">apply</code>);</p><p>2.3 d[5] += value; (in the <code class="tt">modify</code> loop);</p><p>...</p><p>d[5] is passed to 5's son 10 and 11, so:</p><p>2.4 <strong>d[10] = d[10] + (d[2] + value);</strong></p><p>1.5 is equal to 2.4, because (a+b)+c = a+(b+c), but if I replace the <code class="tt">+</code> to other special operation which does not satisfy the associative law, what should I do in <code class="tt">Lazy propagation</code>.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-269883 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-269883 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-269883">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="269891" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/NYU">
<img src="./Efficient and easy segment trees - Codeforces_files/69eaf4bb6f14b55b.jpg">        </a>
        <div><a href="http://codeforces.com/profile/NYU" title="Expert NYU" class="rated-user user-blue">NYU</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/30/2015 17:48 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-269891" href="http://codeforces.com/blog/entry/18051?#comment-269891" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="269891" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="269891" data-commentrating="0" data-commentuserid="214122">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-269891">
                    <div class="moveup">
                    <div class="ttypography"><p>Hi, I enjoy your post. Just wondering do you have templates for 2-D segment tree as well?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-269891 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-269891 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-269891">
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="270190" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Arpa">
<img src="./Efficient and easy segment trees - Codeforces_files/f9ceea2004e2a8d0.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Arpa" title="Candidate Master Arpa" class="rated-user user-violet">Arpa</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Dec/31/2015 18:47 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-270190" href="http://codeforces.com/blog/entry/18051?#comment-270190" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="270190" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="270190" data-commentrating="0" data-commentuserid="124237">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-270190">
                    <div class="moveup">
                    <div class="ttypography"><p>[user:chz,2015-12-31] has post about data structures:<a href="http://codeforces.com/blog/entry/15729">Link</a>.</p><p>And for segment tree:<a href="http://codeforces.com/blog/entry/15890">Link</a>.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-270190 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-270190 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-270190">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="275671" commentparentid="270190">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/sheri.mori">
<img src="./Efficient and easy segment trees - Codeforces_files/64ba0fe07623bc31.jpg">        </a>
        <div><a href="http://codeforces.com/profile/sheri.mori" title="Expert sheri.mori" class="rated-user user-blue">sheri.mori</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/31/2016 01:47 UTC+5.5">2 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-275671" href="http://codeforces.com/blog/entry/18051?#comment-275671" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-270190" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="275671" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="275671" data-commentrating="0" data-commentuserid="275569">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-275671">
                    <div class="moveup">
                    <div class="ttypography"><p>He is <a class="rated-user user-red" href="http://codeforces.com/profile/amd" title="Grandmaster amd">amd</a> now</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-275671 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-275671 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-275671">
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table" commentid="270716" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/-RooneY-">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/-RooneY-" title="Expert -RooneY-" class="rated-user user-blue">-RooneY-</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    
                    <span class="item"><span class="format-humantime" title="Jan/03/2016 18:39 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-270716" href="http://codeforces.com/blog/entry/18051?#comment-270716" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="270716" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="270716" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="270716" data-commentrating="0" data-commentuserid="541">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-270716">
                    <div class="moveup">
                    <div class="ttypography"><p>N.A.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-270716 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-270716 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-270716">
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="271254" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/shyam81295">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/shyam81295" title="Newbie shyam81295" class="rated-user user-gray">shyam81295</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/07/2016 23:39 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-271254" href="http://codeforces.com/blog/entry/18051?#comment-271254" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="271254" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="271254" data-commentrating="0" data-commentuserid="259627">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-271254">
                    <div class="moveup">
                    <div class="ttypography"><p>I solved some questions based on this method (non-recursive segment trees) and it worked like a charm,but I think this method fails when building of tree depends on position of nodes for calculations, i.e. when there is non-combiner functions. Example: <a href="https://www.hackerearth.com/problem/algorithm/2-vs-3/">https://www.hackerearth.com/problem/algorithm/2-vs-3/</a></p><p>Is it possible to solve this problem using above mentioned method ?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-271254 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-271254 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-271254">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="271257" commentparentid="271254">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/yeputons">
<img src="./Efficient and easy segment trees - Codeforces_files/cfc26825136c163e.jpg">        </a>
        <div><a href="http://codeforces.com/profile/yeputons" title="International Grandmaster yeputons" class="rated-user user-red">yeputons</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/08/2016 00:58 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-271257" href="http://codeforces.com/blog/entry/18051?#comment-271257" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-271254" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="271257" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="271257" data-commentrating="0" data-commentuserid="2412">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-271257">
                    <div class="moveup">
                    <div class="ttypography"><p>Sure. Non-recursive bottom-top approach changes order of calculations and node visiting only. If that does not matter (and it does not if there are no complex group operations), you can apply all top-bottom tricks, including dependency on node's position. One way is to get node's interval's borders based on its id, another way is to simple 'embed' all necessary information into node inself, so it not only know value modulo 3, but also its length (or which power of 3 we should use when appending that node to the right).</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-271257 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-271257 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-271257">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="271300" commentparentid="271257">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/shyam81295">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/shyam81295" title="Newbie shyam81295" class="rated-user user-gray">shyam81295</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/08/2016 15:02 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-271300" href="http://codeforces.com/blog/entry/18051?#comment-271300" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-271257" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="271300" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="271300" data-commentrating="0" data-commentuserid="259627">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-271300">
                    <div class="moveup">
                    <div class="ttypography"><p>Yes. Embedding would be useful addition in this method. Thanks for helping. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-271300 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-271300 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-271300">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="274004" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Ahmadshallouf">
<img src="./Efficient and easy segment trees - Codeforces_files/bc9ba78fa17ca2f7.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Ahmadshallouf" title="Expert Ahmadshallouf" class="rated-user user-blue">Ahmadshallouf</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/22/2016 04:53 UTC+5.5">3 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-274004" href="http://codeforces.com/blog/entry/18051?#comment-274004" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="274004" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="274004" data-commentrating="0" data-commentuserid="282228">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-274004">
                    <div class="moveup">
                    <div class="ttypography"><p>the range modify function is not working can you explain it please ?</p><p>void modify(int l, int r, int value) {  for (l += n, r += n; l &lt; r; l &gt;&gt;= 1, r &gt;&gt;= 1) {  if (l&amp;1) t[l++] += value;  if (r&amp;1) t[--r] += value;  } }</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-274004 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-274004 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-274004">
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="275686" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/sheri.mori">
<img src="./Efficient and easy segment trees - Codeforces_files/64ba0fe07623bc31.jpg">        </a>
        <div><a href="http://codeforces.com/profile/sheri.mori" title="Expert sheri.mori" class="rated-user user-blue">sheri.mori</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Jan/31/2016 02:37 UTC+5.5">2 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-275686" href="http://codeforces.com/blog/entry/18051?#comment-275686" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="275686" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="275686" revisioncount="3" revision="3">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">3</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="275686" data-commentrating="0" data-commentuserid="275569">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-275686">
                    <div class="moveup">
                    <div class="ttypography"><p>First thank you for this awesome tutorial.But one thing I was confused about ever since I read the first code was why do you always say : <code class="tt">if (r&amp;1)</code> shouldn't it be <code class="tt">if ((r^1)&amp;1)</code> ? because if r is odd then we have all of the children of its parent , so we do the changes to its parent rather than r itself.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-275686 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-275686 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-275686">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="276963" commentparentid="275686">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/csssaz">
<img src="./Efficient and easy segment trees - Codeforces_files/c8fbd9463a80b0a1.jpg">        </a>
        <div><a href="http://codeforces.com/profile/csssaz" title="Expert csssaz" class="rated-user user-blue">csssaz</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Feb/06/2016 02:28 UTC+5.5">2 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-276963" href="http://codeforces.com/blog/entry/18051?#comment-276963" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-275686" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="276963" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        <span style="" commentid="276963" revisioncount="2" revision="2">
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;color:#bebebe;" class="leftRevision">←</a>
                            Rev. <span class="revision">2</span>
                            <a href="http://codeforces.com/blog/entry/18051#" style="text-decoration:none;font-size:1.4rem;visibility:hidden;color:#bebebe;" class="rightRevision">→</a>
                        </span>
                        &nbsp;

<span commentid="276963" data-commentrating="0" data-commentuserid="263152">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-276963">
                    <div class="moveup">
                    <div class="ttypography"><p>remember that operations are defined as [l, r), so r always refers to the element in the right of your inclusive range. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-276963 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-276963 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-276963">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="276980" commentparentid="276963">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/sheri.mori">
<img src="./Efficient and easy segment trees - Codeforces_files/64ba0fe07623bc31.jpg">        </a>
        <div><a href="http://codeforces.com/profile/sheri.mori" title="Expert sheri.mori" class="rated-user user-blue">sheri.mori</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Feb/06/2016 10:17 UTC+5.5">2 months ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-276980" href="http://codeforces.com/blog/entry/18051?#comment-276980" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-276963" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="276980" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="276980" data-commentrating="0" data-commentuserid="275569">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-276980">
                    <div class="moveup">
                    <div class="ttypography"><p>Yeah. Thx. got it</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-276980 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-276980 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-276980">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="280527" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/ChristopherBoo">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/ChristopherBoo" title="Expert ChristopherBoo" class="rated-user user-blue">ChristopherBoo</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Feb/26/2016 07:07 UTC+5.5">6 weeks ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-280527" href="http://codeforces.com/blog/entry/18051?#comment-280527" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="280527" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="280527" data-commentrating="8" data-commentuserid="262131">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+8</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-280527">
                    <div class="moveup">
                    <div class="ttypography"><p>This blog is brilliant! Can you also add a section on Persistent Segment Tree? We need to create new nodes when updating a node, how can it be done efficiently using this kind of segment tree? Thanks!</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-280527 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-280527 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-280527">
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="285866" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/theMonkeyKing">
<img src="./Efficient and easy segment trees - Codeforces_files/94e3c1df8d795f45.jpg">        </a>
        <div><a href="http://codeforces.com/profile/theMonkeyKing" title="Pupil theMonkeyKing" class="rated-user user-green">theMonkeyKing</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Mar/25/2016 01:34 UTC+5.5">2 weeks ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-285866" href="http://codeforces.com/blog/entry/18051?#comment-285866" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="285866" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="285866" data-commentrating="0" data-commentuserid="363394">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-285866">
                    <div class="moveup">
                    <div class="ttypography"><p>A wonderful implementation of segment tree . Thanks for this awesome article. If you write another blog or add a section in this blog on <strong>persistent segment tree</strong> (non-recursive implementation) that will be very helpful. </p><p>Thanks Again :) @Al.Cash</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-285866 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-285866 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-285866">
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="287327" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/YukimuraYukino">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/YukimuraYukino" title="Specialist YukimuraYukino" class="rated-user user-cyan">YukimuraYukino</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/01/2016 01:28 UTC+5.5">7 days ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-287327" href="http://codeforces.com/blog/entry/18051?#comment-287327" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="287327" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="287327" data-commentrating="0" data-commentuserid="403400">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-287327">
                    <div class="moveup">
                    <div class="ttypography"><p>How to implement the query method for problems like this: <a href="http://codeforces.com/problemset/problem/145/E">145E</a> ? </p><p>I tried dividing the array into O(log n) disjoint segment and then DP on them and got AC, but it made me implement a lot more thing, and I think it won't work if the problem asks to print answer for a segment [l; r], for example, GSS1 on SPOJ.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-287327 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-287327 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-287327">
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="287332" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/adamant">
<img src="./Efficient and easy segment trees - Codeforces_files/bb5daaf48be56f50.jpg">        </a>
        <div><a href="http://codeforces.com/profile/adamant" title="Master adamant" class="rated-user user-orange">adamant</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/01/2016 01:45 UTC+5.5">7 days ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-287332" href="http://codeforces.com/blog/entry/18051?#comment-287332" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="287332" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="287332" data-commentrating="8" data-commentuserid="50468">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+8</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-287332">
                    <div class="moveup">
                    <div class="ttypography"><p>Hi, <a class="rated-user user-red" href="http://codeforces.com/profile/Al.Cash" title="Международный гроссмейстер Al.Cash">Al.Cash</a>!</p><p>Frankly saying, I didn't watch the whole entry. But anyway I want to coin something. </p><p>The reason I use recursive implementation of segment trees besides that it is clear and simple is the fact that it is very generic. Many modifications of it come with no cost. For example it is the matter of additional 5-10 lines to make the tree persistent or to make it work on some huge interval like <span class="tex-span">[0;10<sup class="upper-index">9</sup>]</span>. Your tree is heavily based on binary indexation. So, such modifications should be pretty hard. Am I correct?</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-287332 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-287332 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-287332">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="288022" commentparentid="287332">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/Al.Cash">
<img src="./Efficient and easy segment trees - Codeforces_files/af30a37f52db3218.jpg">        </a>
        <div><a href="http://codeforces.com/profile/Al.Cash" title="International Grandmaster Al.Cash" class="rated-user user-red">Al.Cash</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/06/2016 00:58 UTC+5.5">40 hours ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-288022" href="http://codeforces.com/blog/entry/18051?#comment-288022" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-287332" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="288022" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="288022" data-commentrating="13" data-commentuserid="14750">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:green;font-weight:bold;">+13</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-288022">
                    <div class="moveup">
                    <div class="ttypography"><p>True, is't impossible to modify this approach to support persistency or arbitrary intervals. However it handles all other cases better and they are the vast majority. Especially it's noticeable in the simplest (and the most common) case.</p><p>The choice is up to you, of course :)</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-288022 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-288022 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-288022">
    </ul>
</div>
</li>
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="288066" commentparentid="287332">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/NSV">
<img src="./Efficient and easy segment trees - Codeforces_files/32adf5df347b8168.jpg">        </a>
        <div><a href="http://codeforces.com/profile/NSV" title="Candidate Master NSV" class="rated-user user-violet">NSV</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/06/2016 03:28 UTC+5.5">37 hours ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-288066" href="http://codeforces.com/blog/entry/18051?#comment-288066" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-287332" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="288066" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="288066" data-commentrating="0" data-commentuserid="9904">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-288066">
                    <div class="moveup">
                    <div class="ttypography"><p>BTW you can just use unordered_map instead of array in order to make it work on some huge interval like <span class="tex-span">[0;10<sup class="upper-index">9</sup>]</span>. AFAIK it's well known trick used with Fenwick Tree.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-288066 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-288066 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-288066">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="288074" commentparentid="288066">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/adamant">
<img src="./Efficient and easy segment trees - Codeforces_files/bb5daaf48be56f50.jpg">        </a>
        <div><a href="http://codeforces.com/profile/adamant" title="Master adamant" class="rated-user user-orange">adamant</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/06/2016 03:48 UTC+5.5">37 hours ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-288074" href="http://codeforces.com/blog/entry/18051?#comment-288074" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-288066" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="288074" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="288074" data-commentrating="0" data-commentuserid="50468">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-288074">
                    <div class="moveup">
                    <div class="ttypography"><p>Noooo. Very, very, very bad idea. The constant is too large even for Fenwick. Many problems where <span class="tex-span">[0;10<sup class="upper-index">9</sup>]</span> expect participant to compress the data instead of using dynamic structure, so it is usually hard to get accepted even with fair dynamic tree. Using unordered_map instead of it is simply waste of time, in my opinion. </p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-288074 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-288074 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-288074">
            <li>
<div class="comment">
    <table class="comment-table highlight-blue" commentid="288075" commentparentid="288074">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/NSV">
<img src="./Efficient and easy segment trees - Codeforces_files/32adf5df347b8168.jpg">        </a>
        <div><a href="http://codeforces.com/profile/NSV" title="Candidate Master NSV" class="rated-user user-violet">NSV</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/06/2016 04:01 UTC+5.5">37 hours ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-288075" href="http://codeforces.com/blog/entry/18051?#comment-288075" style="font-size:1.2em;">#</a></span>
                        <span class="item"><a title="Parent comment" href="http://codeforces.com/blog/entry/18051#comment-288074" style="font-size:1.2em;">^</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="288075" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="288075" data-commentrating="0" data-commentuserid="9904">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-288075">
                    <div class="moveup">
                    <div class="ttypography"><p>Yes, you are right, data compression of course better. But I guess that perfomance of BIT + unordered_map is not so much worse than performance of dynamic tree. From another hand it's extremely easy way to modify this data structure and it's also possible for some problems.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-288075 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-288075 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-288075">
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>
</li>
    </ul>
</div>

<div class="comment">
    <table class="comment-table highlight-blue" commentid="287990" commentparentid="-1">
        <tbody><tr>
            <td class="left">
                <div style="position: absolute; left: 0;" class="comment-indent-holder">
                        <div class="comment-no-indent">
                            <span>»</span>
                        </div>
                </div>
    <div class="avatar">
        <a href="http://codeforces.com/profile/iskon">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/iskon" title="Pupil iskon" class="rated-user user-green">iskon</a></div>
    </div>
            </td>
            <td class="right">
                <div class="info">
                    <span style="font-weight: bold;">new</span>,
                    <span class="item"><span class="format-humantime" title="Apr/05/2016 21:39 UTC+5.5">43 hours ago</span>,</span>
                    <span class="item"><a title="Link to comment" name="comment-287990" href="http://codeforces.com/blog/entry/18051?#comment-287990" style="font-size:1.2em;">#</a></span>
                    <span class="item">|</span>
                    <span style="position: relative; top: 2px;">
    <span>
            <img class="toggle-favourite add-favourite" title="Add to favourites" alt="Add to favourites" data-type="COMMENT" data-entityid="287990" data-size="12" src="./Efficient and easy segment trees - Codeforces_files/star_gray_12.png">
    </span>

</span>
                    <div style="position:absolute;right:0;top:0;">
                        &nbsp;

<span commentid="287990" data-commentrating="0" data-commentuserid="254802">
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="1" dd="x"><img style="position:relative;top:3px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-voteup-blue.png" alt="Vote: I like it" title="Vote: I like it"></a>
<span class="commentRating"><span style="color:gray;font-weight:bold;">0</span></span>
<a href="http://codeforces.com/blog/entry/18051#" class="vote-for-comment" votedirection="-1" dd="y"><img style="position:relative;top:2px;opacity:0.35;" src="./Efficient and easy segment trees - Codeforces_files/comment-votedown-blue.png" alt="Vote: I do not like it" title="Vote: I do not like it"></a>
</span>                    </div>
                </div>
                <div class="comment-content comment-content-287990">
                    <div class="moveup">
                    <div class="ttypography"><p>can we find sum of elements(of different sets respectively) of a power set using segment tree?Explain.</p></div>
                    </div>
                </div>
                <div class="reply info">
                    <a class="comment-287990 en false" href="http://codeforces.com/blog/entry/18051#" style="text-decoration: none;"><span class="arrow">→</span></a>
                    <a class="comment-287990 en false" href="http://codeforces.com/blog/entry/18051#">Reply</a>
                </div>
            </td>
        </tr>
    </tbody></table>
    <ul class="comment-children comment-287990">
    </ul>
</div>
    <br>

<div id="editBox-18130" style="width:50em;display:none;">
    <textarea data-drafts-id="CommentReplyFrame" class="wysiwyg" name="editContent" rows="20" style="width:99%;"></textarea>
    <div class="error error__content"></div>
    <div style="text-align:center;">
        <input type="button" style="padding: 0.25em 1em; margin-top: 1em;" value="Save">
    </div>
</div>

    <script type="text/javascript">
        $(document).ready(function () {
if (!window.moveCommentRevision) {
    moveCommentRevision = function(e, dir) {
        var p = e.parent();
        var revisionCount = parseInt(p.attr("revisionCount"));
        var revision = parseInt(p.attr("revision"));
        var next = revision + dir;
        var commentId = p.attr("commentId");
        if (next >= 1 && next <= revisionCount) {
            $.post(
                "/data/comment-data",
                {action: "revision", commentId: commentId, revision: next},
                function(json) {
                    if (json.success == "true") {
                        var parentDiv = e;

                        while (parentDiv !== null && (parentDiv[0].nodeName.toLowerCase() !== "td" || !parentDiv.hasClass("right"))) {
                            parentDiv = parentDiv.parent();
                        }

                        if (parentDiv === null) {
                            return;
                        }

                        parentDiv.find("div.comment-content-" + commentId + " .moveup").html(json.content);
                        Codeforces.setupSpoilers(parentDiv.find("div.comment-content-" + commentId + " .moveup"));
                        p.attr("revision", next);
                        p.find("span.revision").text(next);
                        if (next == 1) {
                            p.find("a.leftRevision").css("visibility", "hidden");
                        } else {
                            p.find("a.leftRevision").css("visibility", "visible");
                        }
                        if (next == revisionCount) {
                            p.find("a.rightRevision").css("visibility", "hidden");
                        } else {
                            p.find("a.rightRevision").css("visibility", "visible");
                        }

                        window.updateTypography();
                    } else {
                        alert(e.error);
                    }
                },
                "json"
            );
        }
    };
}

$("div[commentableId=18130] a.leftRevision").click(function () {
    window.moveCommentRevision($(this), -1);
    return false;
});

$("div[commentableId=18130] a.rightRevision").click(function () {
    window.moveCommentRevision($(this), +1);
    return false;
});

    $("div[commentableId=18130] a.editCommentLink").click(function () {
        if (confirm("You may edit your comment only for fixing grammar mistakes or small changes. Do not change the main idea of your comment. All previous revisions are available for others. Are you sure you want to edit comment?")) {
            Codeforces.facebox("#editBox-18130", "http://st.codeforces.com/s/95517");
            $("#facebox #editBox-18130 textarea.wysiwyg").drafts({textDrafts: "Drafts", textUseIt: "Use it", url: "/data/draft", saveErrorMessage: "Can't save draft. Possibly connection is lost or session is expired. Stay on the page (cancel to reload)?"});
            var commentId = $(this).attr("commentId");
            $.post("/data/comment-data", {action: "content", commentId: commentId}, function(json) {
                if (json["success"] != "true") {
                    alert(json["error"]);
                    return;
                }
                var content = json["content"];
                $("#facebox #editBox-18130 textarea.wysiwyg").val(content);


                $("#facebox #editBox-18130 textarea.wysiwyg").css("width", "97%").markItUp(commentSettings).css("height", "200px");

                $("#facebox #editBox-18130 input[type='button']").click(function () {
                    var content = $("#facebox #editBox-18130 textarea.wysiwyg").val();
                    $.post(
                        "/data/comment-data",
                        {action: "update", commentId: commentId, content: content},
                        function(json) {
                            if (json.success == "true") {
                                Codeforces.reload();
                            } else {
                                $("#facebox #editBox-18130 div.error__content").text(json.error__content);
                                window.updateTypography();
                            }
                        },
                        "json"
                    );

                    return false;
                });
            }, "json");
        }
        return false;
    });

    $("div[commentableId=18130] a.deleteCommentLink").click(function () {
        if (confirm("Are you sure you want to delete this comment?")) {
            var commentId = $(this).attr("commentId");
            $.post("/data/comment-data", {action: "delete", commentId: commentId}, function(json) {
                if (json.success == "true") {
                    Codeforces.reload();
                } else {
                    alert(json.error);
                }
            }, "json");
        }
        return false;
    });
        });
    </script>

<div class="comment comment-reply-prototype" style="display:none;">
        <table class="comment-table" style="width: 100%;">
            <tbody><tr>
                <td class="left">
    <div class="avatar">
        <a href="http://codeforces.com/profile/f2013083">
<img src="./Efficient and easy segment trees - Codeforces_files/no-avatar.jpg">        </a>
        <div><a href="http://codeforces.com/profile/f2013083" title="Unrated, f2013083" class="rated-user user-black">f2013083</a></div>
    </div>
                </td>
                <td class="right" style="padding:1em;">
                    <form action="" method="post" class="commentReplyForm"><input type="hidden" name="csrf_token" value="69ee2bd7d44d6e12dd066fadc0fc0172">
                        <input type="hidden" name="commentReplyFormSubmitted" value="true">
                        <input type="hidden" name="commentId">
                        <input type="hidden" name="hasMaximalDepth">
                        <input type="hidden" name="commentableId">
                        <table class="table-form" style="width:100%;">
                            <tbody><tr>
                                <td style="width: 1px">&nbsp;</td><td>
                                <div style="position: relative; top: 0.5em;left:4px;">
                                    <input type="radio" name="locale" value="en"><span style="font-size: 1.2rem;position: relative; bottom: 3px;">In English</span>
                                    <input style="margin-left:1em" type="radio" name="locale" value="ru"><span style="font-size: 1.2rem;position: relative; bottom: 3px;">In Russian</span>
                                </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 1px;">&nbsp;</td><td>
                                    <div class="previewBody" style="border: 1px solid #d4d4d4; margin-bottom: 0.5em; padding: 0.25em; display:none;">&nbsp;</div>
                                    <textarea data-drafts-id="CommentReplyFrame" class="no-wysiwyg" name="replyContent" rows="10" style="width: 100%;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" valign="top">
                                    <div style="float: left;" class="small">
         <div class="shiftUp error__commentWithId">
             <span class="error for__commentWithId " style="display: none;">&nbsp;</span>
             <span class="notice for__commentWithId ">&nbsp;</span>
         </div>
         <div class="shiftUp error__content">
             <span class="error for__content " style="display: none;">&nbsp;</span>
             <span class="notice for__content ">&nbsp;</span>
         </div>
                                    </div>
                                    <div style="position: relative; right: 4px;text-align:right;">
                                        <input style="font-size: 0.7em;height:1.8em;padding:0 0.75em;" type="submit" name="submit" value="Post">
                                        <input style="font-size: 0.7em;height:1.8em;padding:0 0.75em;" type="button" class="preview" value="Preview">
                                        <input style="font-size: 0.7em;height:1.8em;padding:0 0.75em;" type="button" class="cancel" value="Cancel">
                                    </div>
                                </td>
                            </tr>
                        </tbody></table>
                    <input type="hidden" name="_tta" value="810"></form>
                </td>
            </tr>
        </tbody></table>
</div>

        <script type="text/javascript">
            $(function() {
                window._ftaa = "ur7511p7t2yv6lxr0c";
            })
        </script>

        <script type="text/javascript">
            $(function() {
                window._bfaa = "30392e72e27660ac7edd444e17bf6c09";
            });
        </script>

    <script type="text/javascript">
        $(document).ready(function () {
    var commentPreviewListener = function(div) {
        var content = div.find("textarea").val();
        var replyLocale = div.find('input[name=locale]:checked').val();

        $.post(
            "/data/comment-data",
            {action: "preview", replyLocale: replyLocale, content: content},
            function(json) {
                if (json.success == "true") {
                    div.find(".previewBody").html("<div style='font-size: 1.2rem;'>Comment preview:<hr/></div><div class='comment-content' style='position: relative; bottom: 12px;'>" + json.response + "</div>").fadeIn();
                    Codeforces.setupSpoilers(div.find(".previewBody"));
                } else {
                    div.find(".previewBody").html("<div><b style='color:red;'>Comment preview error:</b><hr/><div>" + json.error__content).fadeIn();
                }
                window.updateTypography();
            },
            "json"
        );

        return false;
    }

    var commentReplyFormSubmitListener = function () {
        var id = $(this).attr("id");
        var hasMaximalDepth = $(this).find("input[name=hasMaximalDepth]").val() || "false";
        var commentWithId = $(this).find("input[name=commentId]").val() || "";
        var content = $(this).find("textarea").val();
        var commentableId = $(this).find("input[name=commentableId]").val() || 0;
        var commentReplyFormSubmitted = $(this).find("input[name=commentReplyFormSubmitted]").val();
        var replyLocale = $(this).find('input[name=locale]:checked').val();

        var postNewCommentReply = function () {
            $.post(
                "/data/new-comment-reply",
                {ftaa: window._ftaa, bfaa: window._bfaa, commentWithId:     commentWithId, content: content, commentReplyFormSubmitted: commentReplyFormSubmitted, _tta: Codeforces.tta(), replyLocale: replyLocale, commentableId: commentableId, subscribedCommentLinkInfix: "EhunNXA3Qw_gyuZIgOfKHJUrHaw*/blog/entry/18051"},
                function(data) {
                    var invalid = Codeforces.setAjaxFormErrors("#" + id , data);
                    var newCommentWithId = data.newCommentWithId;
                    if (!invalid) {
                        var s = window.location.toString();
                        var found = false;
                        for (var i = 0; i < s.length; i++)
                            if (s.charAt(i) == '#') {
                                found = true;
                                index = i;
                            }
                        if (!found) {
                            s += "#" + newCommentWithId;
                        } else {
                            s = s.substr(0, index + 1) + newCommentWithId;
                        }
                        window.location = s;
                        window.location.reload();
                    }
                },
                "json"
            );
        };

        $.post("/data/checkTextForRussianLanguage", { text: content }, function(response) {
            var isRussianComment = response["isRussianComment"];
            if (replyLocale == "en" && isRussianComment == "true") {
                Codeforces.confirm(
                    "Are you sure that your comment in English?",
                    postNewCommentReply, function () { },
                    "Yes", "No"
                );
            } else if (replyLocale == "ru" && isRussianComment == "false") {
                Codeforces.confirm(
                    "Are you sure that your comment in Russian?",
                    postNewCommentReply, function () { },
                    "Yes", "No"
                );
            } else {
                postNewCommentReply();
            }
        }, "json");

        return false;
    }
    $("a.new-root-comment").click(function () {
            var a = $(this);
            a.hide();

            var commentableId = $(".comments").attr("commentableId");
            var e = $(".comment-reply-prototype").clone().removeClass("comment-reply-prototype");

            var div = $("<div></div>").append(e);
            var p = $(this).parent();
            p.prepend(div);
            e.show();

            e.find("input[value=en]").attr("checked", true);
            e.find("input[name=commentableId]").attr("value", commentableId);
            e.find("form").submit(commentReplyFormSubmitListener);
            e.find("form").attr("id", "form-" + (new Date().getTime()));

            div.find('textarea.no-wysiwyg').css("width", "97%").markItUp(commentSettings).css("height", "200px");
            div.find('textarea.no-wysiwyg').removeClass("no-wysiwyg");
            div.find('textarea').drafts({textDrafts: "Drafts", textUseIt: "Use it", url: "/data/draft", saveErrorMessage: "Can't save draft. Possibly connection is lost or session is expired. Stay on the page (cancel to reload)?"});

            var first = true;
            div.find(".cancel").each(function () {
                if (first) {
                    $(this).click(function () {
                        div.remove();
                        a.show();
                        return false;
                    });
                    first = false;
                }
            });

            first = true;
            div.find(".preview").each(function () {
                if (first) {
                    $(this).click(function () {
                        commentPreviewListener(div);
                        return false;
                    });
                    first = false;
                }
            });
        return false;
    });

    $(".comment-table .reply a").click(function () {
            var classes = this.className.split(" ");
            var commentId = classes[0];
            var locale = classes[1];
            var hasMaximalDepth = classes[2];
            var commentableId = $(".comments").attr("commentableId");

            showReplyWindow = function () {
                var e = $(".comment-reply-prototype").clone().removeClass("comment-reply-prototype");

                var li = $("<li></li>").append(e);
                var ul = $(".comment ul." + commentId);
                ul.prepend(li);
                e.show();
                e.find("input[name=commentId]").attr("value", commentId);
                e.find("input[name=hasMaximalDepth]").attr("value", hasMaximalDepth);
                e.find("input[value=" + locale + "]").attr("checked", true);
                e.find("input[name=locale]").attr("readonly", true);
                e.find("input[name=locale]").attr("disabled", true);
                e.find("input[name=commentableId]").attr("value", commentableId);
                e.find("form").submit(commentReplyFormSubmitListener);
                e.find("form").attr("id", "form-" + (new Date().getTime()));

                li.find('textarea').css("width", "97%").markItUp(commentSettings).css("height", "200px");

                setTimeout(function () {
                    li.find('textarea').drafts({textDrafts: "Drafts", textUseIt: "Use it", url: "/data/draft", saveErrorMessage: "Can't save draft. Possibly connection is lost or session is expired. Stay on the page (cancel to reload)?"});
                }, 1000);

                var first = true;
                ul.find(".cancel").each(function () {
                    if (first) {
                        $(this).click(function () {
                            li.remove();
                            return false;
                        });
                        first = false;
                    }
                });

                first = true;
                ul.find(".preview").each(function () {
                    if (first) {
                        $(this).click(function () {
                            commentPreviewListener(ul);
                        });
                        first = false;
                    }
                });
            }

            if (hasMaximalDepth == "true") {
                Codeforces.confirm("The debates reached maximal permitted depth, so your message and the message you are replying will be displayed on the same level. Are you sure you want to reply to the message?", showReplyWindow, function () { }, "Yes", "No");
            } else {
                showReplyWindow();
            }
        return false;
    });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
    $(".vote-for-comment").mouseover(function () {
        var vote = $(this);
        var direction = vote.attr("voteDirection");
        var commentUserId = $(this).parent().attr("data-commentUserId");
        var ownComment = commentUserId==406411;
        if (direction == 1 && !ownComment) {
            vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-voteup.png");
            vote.find("img").attr("popacity", vote.find("img").css("opacity"));
            vote.find("img").css("opacity", "1.0");
        }
        if (direction == -1 && !ownComment) {
            vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-votedown.png");
            vote.find("img").attr("popacity", vote.find("img").css("opacity"));
            vote.find("img").css("opacity", "1.0");
        }
    });

    $(".vote-for-comment").mouseout(function () {
        var vote = $(this);
        var direction = vote.attr("voteDirection");
        var commentUserId = $(this).parent().attr("data-commentUserId");
        var ownComment = commentUserId==406411;
        if (direction == 1 && !ownComment) {
            vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-voteup-blue.png");
            vote.find("img").css("opacity", vote.find("img").attr("popacity"));
        }
        if (direction == -1 && !ownComment) {
            vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-votedown-blue.png");
            vote.find("img").css("opacity", vote.find("img").attr("popacity"));
        }
    });

    $(".vote-for-comment").click(function () {
        var vote = $(this);
        var commentId = $(this).parent().attr("commentid");
        var commentRating = $(this).parent().attr("data-commentRating");
        var direction = $(this).attr("voteDirection");
        var commentUserId = $(this).parent().attr("data-commentUserId");
        var ownComment = commentUserId==406411;
        $.post("/data/comment/vote", {commentId: commentId, _tta: Codeforces.tta(), vote: direction, commentRating: commentRating}, function(data) {
            if (direction != 0 && !ownComment && data["success"] == "true") {
                vote.parent().find(".vote-for-comment").attr("voteDirection", 0);
                if (direction == 1)
                    vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-voteup.png");
                else
                    vote.find("img").attr("src", "http://st.codeforces.com/s/95517/images/actions/comment-votedown.png");
                vote.find("img").attr("popacity", "1.0");
                vote.find("img").css("opacity", "1.0");
                vote.parent().find(".commentRating").html(data["commentRating"]);
            }
            Codeforces.showMessage(data["message"]);
        }, "json");
        return false;
    });

    $(".negative-comment-vote").closest(".comment-table").addClass("comment-bad");

    $(".troll-comment-vote").closest(".comment").css("display", "none");

    $(".too-negative-comment-vote").closest(".comment-table").each(function () {
        var e = $(this);
        e.addClass("comment-too-bad");
        var commentId = e.attr("commentId");
        $("<div class='bad-comment-replacement ttypography'>The comment is hidden because of too negative feedback, click <a href=# class=show-bad-comment-link>here</a> to view it</div>").appendTo(
            e.find(".right")
        );
        e.find(".comment-content").hide();
        e.find(".show-bad-comment-link").click(function () {
            e.find(".comment-content").show();
            e.find(".bad-comment-replacement").hide();
            return false;
        });
    });
        });
    </script>
</div>

<style type="text/css">
    .new-comments-box {
        padding: 0.5em;
        width: 22px;
        font-size: 1.3rem;
        font-weight: bold !important;

        position: fixed;
        top: 40%;
        right: 0;
        opacity: 0.2;
        color: white;
        text-align: center;

        border: 1px solid #222;
        background-color: #888 !important;
        border-radius: 3px;
        -moz-border-radius: 3px;
        -webkit-border-radius: 3px;
    }

    .new-comments-box:hover {
        opacity: 1;
    }

    .new-comments-box .dir:hover {
        background: #3B5998 !important;
        cursor: pointer;
    }
</style>

<div class="new-comments-box" data-position="outside" data-index="-1" style="">
    <div class="up dir" title="Ctrl+Up">↑<hr></div>
    <div class="info" title="New comments">17</div>
    <div class="down dir" title="Ctrl+Down"><hr>↓</div>
</div>

    <script type="text/javascript">
        $(document).ready(function () {
    function gotoComment(direction) {
        var box = $(".new-comments-box");
        var index = parseInt(box.attr("data-index"));
        if (index == -1)
            index = 0;
        else
            index = Math.max(0, Math.min(parseInt(box.find(".info").text()) - 1, index + direction));
        box.attr("data-index", index);
        var comment = $($(".comment .highlight-blue[commentId]").get(index));
        $('html, body').animate({
          'scrollTop': Math.max(0, comment.offset().top - ($(window).height() - comment.height()) / 2)
        });
        return false;
    }

    $(".new-comments-box .down").click(function () {
        return gotoComment(1);
    });

    $(".new-comments-box .up").click(function () {
        return gotoComment(-1);
    });

    $(document).keydown(function (e) {
         var code = (e.keyCode ? e.keyCode : e.which);
         if (e.ctrlKey) {
            if (code == 38 || code == 40) {
                gotoComment(code - 39);
            }
         }
    });

    var newCommentCount = $(".comment .highlight-blue[commentId]").length;
    if (newCommentCount > 0) {
        $(".new-comments-box .info").text(newCommentCount);
        $(".new-comments-box").show();
    }

    $('table.comment-table').mouseenter(function () {
        var comment = $(this);
        var cnt = 0;
        while (true) {
            var id = comment.attr("commentId");
            var parentId = comment.attr("commentParentId");
            comment.find(".comment-indent-holder:first .comment-no-indent").addClass("comment-indent");
            if (parentId == -1) {
                break;
            }
            comment = $("table.comment-table[commentId=" + parentId + "]");
        }
        return false;
    });

    $('table.comment-table').mouseleave(function () {
        var comment = $(this);
        var cnt = 0;
        while (true) {
            var id = comment.attr("commentId");
            var parentId = comment.attr("commentParentId");
            comment.find(".comment-indent-holder:first .comment-no-indent").removeClass("comment-indent");
            if (parentId == -1) {
                break;
            }
            comment = $("table.comment-table[commentId=" + parentId + "]");
        }
        return false;
    });
        });
    </script>


    <script type="text/javascript">
        $(document).ready(function () {
    $(".topic-vote-up-18113").click(function () {
        $.post("/data/topic/vote", {topicId: 18113, _tta: Codeforces.tta(), topicRevisionId: 68924, vote: +1}, function(data) {
            Codeforces.showMessage(data);
        }, "json");
        return false;
    });
    $(".topic-vote-down-18113").click(function () {
        $.post("/data/topic/vote", {topicId: 18113, _tta: Codeforces.tta(), topicRevisionId: 68924, vote: -1}, function(data) {
            Codeforces.showMessage(data);
        }, "json");
        return false;
    });
        });
    </script>
</div>
        </div>
    </div>
                </div>
        </div>
            <br style="clear: both;">
            <div id="footer">
                <div><a href="http://codeforces.com/">Codeforces</a> (c) Copyright 2010-2016 Mike Mirzayanov</div>
                <div>The only programming contests Web 2.0 platform</div>
                    <div>Server time: Apr/07/2016 16:40:49<sup title="timezone offset" style="font-size:8px;">UTC+5.5</sup> (p1).</div>
                    Desktop version, switch to <a rel="nofollow" class="switchToMobile" href="http://codeforces.com/blog/entry/18051?mobile=true">mobile version</a>.
            </div>
        <script type="text/javascript">
            $(function() {
                $(".switchToMobile").click(function() {
                    Codeforces.redirect(Codeforces.updateUrlParameter(document.location.href, "mobile", "true"));
                    return false;
                });
                $(".switchToDesktop").click(function() {
                    Codeforces.redirect(Codeforces.updateUrlParameter(document.location.href, "mobile", "false"));
                    return false;
                });
            });
        </script>
    <script type="text/javascript">
        $(document).ready(function () {
            if ($(window).width() < 1600) {
                $('.button-up').css('width', '30px').css('line-height', '30px').css('font-size', '20px');
            }

            if ($(window).width() >= 1200) {
                $ (window).scroll (function () {
                    if ($ (this).scrollTop () > 100) {
                        $ ('.button-up').fadeIn();
                    } else {
                        $ ('.button-up').fadeOut();
                    }
                });

                $('.button-up').click(function () {
                    $('body,html').animate({
                        scrollTop: 0
                    }, 500);
                    return false;
                });

                $('.button-up').hover(function () {
                    $(this).animate({
                        'opacity':'1'
                    }).css({'background-color':'#e7ebf0','color':'#6a86a4'});
                }, function () {
                    $(this).animate({
                        'opacity':'0.7'
                    }).css({'background':'none','color':'#d3dbe4'});;
                });
            }
            Codeforces.focusOnError();
        });
    </script>

        <div class="userListsFacebox" style="display:none;">
            <div style="padding: 0.5em; width: 600px; max-height: 200px; overflow-y: auto">
<div class="datatable" style="background-color: #E1E1E1; padding-bottom: 3px;">
            <div class="lt">&nbsp;</div>
            <div class="rt">&nbsp;</div>
            <div class="lb">&nbsp;</div>
            <div class="rb">&nbsp;</div>

            <div style="padding: 4px 0 0 6px;font-size:1.4rem;position:relative;">
                User lists

                <div style="position:absolute;right:0.25em;top:0.35em;">
                    <span style="padding:0;position:relative;bottom:2px;" class="rowCount"></span>

                    <img class="closed" src="./Efficient and easy segment trees - Codeforces_files/control.png">

                    <span class="filter" style="display:none;">
                        <img class="opened" src="./Efficient and easy segment trees - Codeforces_files/control-270.png">
                        <input style="padding:0;position:relative;bottom:2px;border:1px solid #aaa;height:17px;font-size:1.3rem;">
                    </span>
                </div>
            </div>
            <div style="background-color: white;margin:0.3em 3px 0 3px;position:relative;">
            <div class="ilt">&nbsp;</div>
            <div class="irt">&nbsp;</div>
            <table class="">
                    <thead>
                    <tr>
                        <th class="top left right">Name</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="no-items visible"><td style="text-align:left;" colspan="32" class="bottom dark left right">No items</td></tr></tbody>
            </table>
            </div>
        </div>
    <script type="text/javascript">
        $(document).ready(function () {
                // Create new ':containsIgnoreCase' selector for search
                jQuery.expr[':'].containsIgnoreCase = function(a, i, m) {
                    return jQuery(a).text().toUpperCase()
                            .indexOf(m[3].toUpperCase()) >= 0;
                };

                if (window.updateDatatableFilter == undefined) {
                    window.updateDatatableFilter = function(i) {
                        var parent = $(i).parent().parent().parent().parent();
                        $("tr.no-items", parent).remove();
                        $("tr", parent).hide().removeClass('visible');
                        var text = $(i).val();
                        if (text) {
                            $("tr" + ":containsIgnoreCase('" + text + "')", parent).show().addClass('visible');
                        } else {
                            parent.find(".rowCount").text("");
                            $("tr", parent).show().addClass('visible');
                        }

                        var found = false;
                        var visibleRowCount = 0;
                        $("tr", parent).each(function () {
                            if (!found) {
                                if ($(this).find("th").size() > 0) {
                                    $(this).show().addClass('visible');
                                    found = true;
                                }
                            }
                            if ($(this).hasClass('visible')) {
                                visibleRowCount++;
                            }
                        });
                        if (text) {
                            parent.find(".rowCount").text("Matches: " + (visibleRowCount - (found ? 1 : 0)));
                        }
                        if (visibleRowCount == (found ? 1 : 0)) {
                            $("<tr class='no-items visible'><td style=\"text-align:left;\"colspan=\"32\">No items<\/td><\/tr>").appendTo($(parent).find('table'));
                        }
                        $(parent).find("tr td").removeClass("dark");
                        $(parent).find("tr.visible:odd td").addClass("dark");
                    }

                    $(".datatable .closed").click(function () {
                        var parent = $(this).parent();
                        $(this).hide();
                        $(".filter", parent).fadeIn(function () {
                            $("input", parent).val("").focus().css("border", "1px solid #aaa");
                        });
                    });

                    $(".datatable .opened").click(function () {
                        var parent = $(this).parent().parent();
                        $(".filter", parent).fadeOut(function () {
                            $(".closed", parent).show();
                            $("input", parent).val("").each(function () {
                                window.updateDatatableFilter(this);
                            });
                        });
                    });

                    $(".datatable .filter input").keyup(function(e) {
                        window.updateDatatableFilter(this);
                        e.preventDefault();
                        e.stopPropagation();
                    });

                    $(".datatable table").each(function () {
                        var found = false;
                        $("tr", this).each(function () {
                            if (!found && $(this).find("th").size() == 0) {
                                found = true;
                            }
                        });
                        if (!found) {
                            $("<tr class='no-items visible'><td style=\"text-align:left;\"colspan=\"32\">No items<\/td><\/tr>").appendTo(this);
                        }
                    });

                    // Applies styles to datatables.
                    $(".datatable").each(function () {
                        $(this).find("tr:first th").addClass("top");
                        $(this).find("tr:last td").addClass("bottom");
                        $(this).find("tr:odd td").addClass("dark");
                        $(this).find("tr td:first-child, tr th:first-child").addClass("left");
                        $(this).find("tr td:last-child, tr th:last-child").addClass("right");
                    });

                    $(".datatable table.tablesorter").each(function () {
                        $(this).bind("sortEnd", function () {
                            $(".datatable").each(function () {
                                $(this).find("th, td")
                                    .removeClass("top").removeClass("bottom")
                                    .removeClass("left").removeClass("right")
                                    .removeClass("dark");
                                $(this).find("tr:first th").addClass("top");
                                $(this).find("tr:last td").addClass("bottom");
                                $(this).find("tr:odd td").addClass("dark");
                                $(this).find("tr td:first-child, tr th:first-child").addClass("left");
                                $(this).find("tr td:last-child, tr th:last-child").addClass("right");
                            });
                        });
                    });
                }
        });
    </script>
            </div>
        </div>
        <script type="application/javascript">
            $(function() {
                $(".userListMarker").click(function() {
                    $.post("/data/lists", {action: "findTouched"}, function(json) {
                        Codeforces.facebox(".userListsFacebox");
                        var tbody = $("#facebox tbody");
                        tbody.empty();
                        for (var i in json) {
                            tbody.append(
                                    $("<tr></tr>").append(
                                            $("<td></td>").attr("data-readKey", json[i].readKey).text(json[i].name)
                                    )
                            );
                        }
                        Codeforces.updateDatatables();
                        tbody.find("td").css("cursor", "pointer").click(function() {
                            document.location = Codeforces.updateUrlParameter(document.location.href, "list", $(this).attr("data-readKey"));
                        });
                    }, "json");
                });
            });
        </script>


</div><div id="datepick-div" style="display: none;"></div><div id="cboxOverlay" style="display: none;"></div><div id="colorbox" class="" style="display: none; padding-bottom: 42px; padding-right: 42px;"><div id="cboxWrapper"><div><div id="cboxTopLeft" style="float: left;"></div><div id="cboxTopCenter" style="float: left;"></div><div id="cboxTopRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxMiddleLeft" style="float: left;"></div><div id="cboxContent" style="float: left;"><div id="cboxLoadedContent" style="width: 0px; height: 0px; overflow: hidden; float: left;"></div><div id="cboxLoadingOverlay" style="float: left;"></div><div id="cboxLoadingGraphic" style="float: left;"></div><div id="cboxTitle" style="float: left;"></div><div id="cboxCurrent" style="float: left;"></div><div id="cboxNext" style="float: left;"></div><div id="cboxPrevious" style="float: left;"></div><div id="cboxSlideshow" style="float: left;"></div><div id="cboxClose" style="float: left;"></div></div><div id="cboxMiddleRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxBottomLeft" style="float: left;"></div><div id="cboxBottomCenter" style="float: left;"></div><div id="cboxBottomRight" style="float: left;"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div></body></html>